<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoadTest Enterprise | Security Operations Center</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&family=Orbitron:wght@400;700;900&family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        :root {
            --primary: #00ff88;
            --primary-glow: rgba(0, 255, 136, 0.4);
            --primary-dark: #00cc6a;
            --secondary: #00d9ff;
            --secondary-glow: rgba(0, 217, 255, 0.4);
            --accent: #ff6b35;
            --warning: #ffb800;
            --danger: #ff3366;
            --danger-glow: rgba(255, 51, 102, 0.4);
            --success: #00ff88;
            --info: #00d9ff;
            --purple: #9d4edd;
            
            --bg-primary: #0a0a0f;
            --bg-secondary: #0f0f1a;
            --bg-tertiary: #151520;
            --bg-card: #1a1a2e;
            --bg-card-hover: #1f1f35;
            --bg-glass: rgba(26, 26, 46, 0.7);
            
            --text-primary: #ffffff;
            --text-secondary: #b4b4c8;
            --text-muted: #6b6b7f;
            
            --border: #2a2a3e;
            --border-light: #3a3a4e;
            --border-glow: rgba(0, 255, 136, 0.2);
            
            --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.3);
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.4);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.5);
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.6);
            --shadow-xl: 0 16px 64px rgba(0, 0, 0, 0.7);
            --shadow-glow: 0 0 30px var(--primary-glow);
            --shadow-glow-secondary: 0 0 30px var(--secondary-glow);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-primary);
            background-image: 
                radial-gradient(circle at 15% 25%, rgba(0, 255, 136, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 85% 75%, rgba(0, 217, 255, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(157, 78, 221, 0.05) 0%, transparent 50%);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
            overflow-x: hidden;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(90deg, transparent 0%, rgba(0, 255, 136, 0.02) 50%, transparent 100%),
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0, 255, 136, 0.01) 2px, rgba(0, 255, 136, 0.01) 4px);
            pointer-events: none;
            z-index: 0;
            animation: scan 20s linear infinite;
        }
        
        @keyframes scan {
            0% { transform: translateY(0); }
            100% { transform: translateY(100px); }
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, rgba(15, 15, 26, 0.95) 0%, rgba(21, 21, 32, 0.95) 100%);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 1.25rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-md);
        }
        
        .header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
            opacity: 0.5;
        }
        
        .header-content {
            max-width: 1920px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 1.25rem;
        }
        
        .logo {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            font-weight: 900;
            color: var(--bg-primary);
            box-shadow: var(--shadow-glow);
            position: relative;
            overflow: hidden;
        }
        
        .logo::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shine 3s infinite;
        }
        
        @keyframes shine {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        .logo-text {
            display: flex;
            flex-direction: column;
        }
        
        .logo-text h1 {
            font-family: 'Orbitron', monospace;
            font-size: 1.75rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 1px;
            margin-bottom: 0.25rem;
        }
        
        .logo-text .subtitle {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .header-stats {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }
        
        .stat-badge {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.75rem 1.25rem;
            background: var(--bg-glass);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            border: 1px solid var(--border);
            min-width: 90px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stat-badge::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 136, 0.1), transparent);
            transition: left 0.5s;
        }
        
        .stat-badge:hover::before {
            left: 100%;
        }
        
        .stat-badge:hover {
            border-color: var(--primary);
            box-shadow: 0 0 20px var(--primary-glow);
            transform: translateY(-2px);
        }
        
        .stat-badge .value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
        }
        
        .stat-badge .label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
            margin-top: 0.25rem;
        }
        
        /* Main Container */
        .container {
            max-width: 1920px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }
        
        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 2rem;
            background: var(--bg-glass);
            backdrop-filter: blur(10px);
            padding: 0.75rem;
            border-radius: 16px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-md);
        }
        
        .nav-tab {
            flex: 1;
            padding: 1rem 1.5rem;
            background: transparent;
            border: none;
            border-radius: 12px;
            color: var(--text-secondary);
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .nav-tab::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 12px;
            padding: 2px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .nav-tab:hover {
            color: var(--text-primary);
            background: var(--bg-tertiary);
            transform: translateY(-2px);
        }
        
        .nav-tab.active {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.15) 0%, rgba(0, 217, 255, 0.15) 100%);
            color: var(--primary);
            box-shadow: var(--shadow-sm);
        }
        
        .nav-tab.active::before {
            opacity: 1;
        }
        
        .nav-tab i {
            font-size: 1.1rem;
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeInUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Grid Layout */
        .grid {
            display: grid;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .grid-2 {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .grid-3 {
            grid-template-columns: repeat(3, 1fr);
        }
        
        .grid-4 {
            grid-template-columns: repeat(4, 1fr);
        }
        
        .grid-auto {
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        }
        
        /* Cards */
        .card {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            opacity: 0;
            transition: opacity 0.4s;
        }
        
        .card:hover {
            border-color: var(--border-light);
            box-shadow: var(--shadow-lg), var(--shadow-glow);
            transform: translateY(-4px);
        }
        
        .card:hover::before {
            opacity: 1;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border);
        }
        
        .card-title {
            font-size: 0.95rem;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .card-title i {
            color: var(--primary);
            font-size: 1.1rem;
        }
        
        .card-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.2) 0%, rgba(0, 217, 255, 0.2) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            border: 1px solid var(--border);
        }
        
        .card-body {
            position: relative;
        }
        
        /* Metric Cards */
        .metric-card {
            text-align: center;
            padding: 2.5rem 2rem;
        }
        
        .metric-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 1.5rem 0;
            line-height: 1;
            text-shadow: 0 0 30px var(--primary-glow);
        }
        
        .metric-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 600;
        }
        
        .metric-change {
            font-size: 0.8rem;
            margin-top: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .metric-change.positive {
            color: var(--success);
        }
        
        .metric-change.negative {
            color: var(--danger);
        }
        
        /* Charts */
        .chart-container {
            position: relative;
            height: 320px;
            margin-top: 1.5rem;
        }
        
        .chart-container.large {
            height: 450px;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 1.75rem;
        }
        
        .form-label {
            display: block;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .form-input,
        .form-select {
            width: 100%;
            padding: 1rem 1.25rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }
        
        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px var(--primary-glow);
            background: var(--bg-card);
        }
        
        .form-checkbox {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            padding: 0.75rem;
            border-radius: 8px;
            transition: background 0.3s;
        }
        
        .form-checkbox:hover {
            background: var(--bg-tertiary);
        }
        
        .form-checkbox input[type="checkbox"] {
            width: 22px;
            height: 22px;
            accent-color: var(--primary);
            cursor: pointer;
        }
        
        /* Buttons */
        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 12px;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--bg-primary);
            box-shadow: 0 4px 20px var(--primary-glow);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px var(--primary-glow);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #cc1a3d 100%);
            color: white;
            box-shadow: 0 4px 20px var(--danger-glow);
        }
        
        .btn-danger:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px var(--danger-glow);
        }
        
        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }
        
        .btn-secondary:hover {
            background: var(--bg-card);
            border-color: var(--border-light);
            transform: translateY(-2px);
        }
        
        .btn-group {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }
        
        /* Status Badge */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }
        
        .status-badge.active {
            background: rgba(0, 255, 136, 0.15);
            color: var(--success);
            border: 1px solid rgba(0, 255, 136, 0.3);
            box-shadow: 0 0 20px var(--primary-glow);
        }
        
        .status-badge.inactive {
            background: rgba(107, 107, 127, 0.15);
            color: var(--text-secondary);
            border: 1px solid rgba(107, 107, 127, 0.3);
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .status-badge.active .status-dot {
            background: var(--success);
            box-shadow: 0 0 15px var(--success);
        }
        
        .status-badge.inactive .status-dot {
            background: var(--text-secondary);
        }
        
        @keyframes pulse {
            0%, 100% { 
                opacity: 1;
                transform: scale(1);
            }
            50% { 
                opacity: 0.6; 
                transform: scale(1.2);
            }
        }
        
        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 10px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            overflow: hidden;
            margin-top: 1rem;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 8px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 20px var(--primary-glow);
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: progress-shine 2s infinite;
        }
        
        @keyframes progress-shine {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        /* Table */
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table th,
        .table td {
            padding: 1.25rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        .table th {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }
        
        .table td {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            color: var(--text-primary);
        }
        
        .table tr:hover {
            background: var(--bg-tertiary);
        }
        
        /* Alerts */
        .alert {
            padding: 1.25rem 1.75rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            border-left: 4px solid;
            backdrop-filter: blur(10px);
            animation: slideInRight 0.4s ease;
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .alert-success {
            background: rgba(0, 255, 136, 0.15);
            border-color: var(--success);
            color: var(--success);
        }
        
        .alert-error {
            background: rgba(255, 51, 102, 0.15);
            border-color: var(--danger);
            color: var(--danger);
        }
        
        .alert-warning {
            background: rgba(255, 184, 0, 0.15);
            border-color: var(--warning);
            color: var(--warning);
        }
        
        /* Tool Status Grid */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 1.25rem;
        }
        
        .tool-item {
            padding: 1.25rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }
        
        .tool-item:hover {
            border-color: var(--border-light);
            background: var(--bg-card);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .tool-item.available {
            border-left: 4px solid var(--success);
        }
        
        .tool-item.unavailable {
            border-left: 4px solid var(--text-muted);
            opacity: 0.6;
        }
        
        .tool-name {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.95rem;
            color: var(--text-primary);
            font-weight: 600;
        }
        
        .tool-status {
            font-size: 1.3rem;
            color: var(--success);
        }
        
        .tool-item.unavailable .tool-status {
            color: var(--text-muted);
        }
        
        /* Loading Spinner */
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 3rem auto;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 1400px) {
            .grid-4 { grid-template-columns: repeat(2, 1fr); }
        }
        
        @media (max-width: 1024px) {
            .grid-3 { grid-template-columns: repeat(2, 1fr); }
            .grid-2 { grid-template-columns: 1fr; }
        }
        
        @media (max-width: 768px) {
            .container { padding: 1rem; }
            .header-content { flex-direction: column; gap: 1.5rem; }
            .header-stats { flex-wrap: wrap; justify-content: center; }
            .grid { grid-template-columns: 1fr; }
            .nav-tabs { flex-wrap: wrap; }
            .nav-tab { flex: 1 1 auto; min-width: 120px; }
            .metric-value { font-size: 2rem; }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo">LT</div>
                <div class="logo-text">
            <h1>LoadTest Enterprise</h1>
                    <div class="subtitle">Security Operations Center</div>
        </div>
        </div>
            <div class="header-stats">
                <div class="stat-badge">
                    <div class="value" id="header-requests">0</div>
                    <div class="label">Requests</div>
                </div>
                <div class="stat-badge">
                    <div class="value" id="header-rps">0</div>
                    <div class="label">RPS</div>
                </div>
                <div class="stat-badge">
                    <div class="value" id="header-errors">0</div>
                    <div class="label">Errors</div>
                </div>
                <div class="status-badge" id="attack-status-badge">
                    <span class="status-dot"></span>
                    <span>Inactivo</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Navigation Tabs -->
        <nav class="nav-tabs">
            <button class="nav-tab active" data-tab="dashboard">
                <i class="fas fa-chart-line"></i>
                <span>Dashboard</span>
            </button>
            <button class="nav-tab" data-tab="configuration">
                <i class="fas fa-cog"></i>
                <span>Configuraci√≥n</span>
            </button>
            <button class="nav-tab" data-tab="monitoring">
                <i class="fas fa-eye"></i>
                <span>Monitoreo</span>
            </button>
            <button class="nav-tab" data-tab="reports">
                <i class="fas fa-file-alt"></i>
                <span>Reportes</span>
            </button>
            <button class="nav-tab" data-tab="tools">
                <i class="fas fa-tools"></i>
                <span>Herramientas</span>
            </button>
            <button class="nav-tab" data-tab="system">
                <i class="fas fa-server"></i>
                <span>Sistema</span>
            </button>
        </nav>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <!-- Key Metrics -->
            <div class="grid grid-4">
                <div class="card metric-card">
                    <div class="card-title">
                        <i class="fas fa-paper-plane"></i>
                        Requests Totales
                    </div>
                    <div class="metric-value" id="metric-requests">0</div>
                    <div class="metric-label">Total Enviados</div>
                    </div>
                <div class="card metric-card">
                    <div class="card-title">
                        <i class="fas fa-tachometer-alt"></i>
                        Requests por Segundo
                    </div>
                    <div class="metric-value" id="metric-rps">0</div>
                    <div class="metric-label">RPS Actual</div>
                    </div>
                <div class="card metric-card">
                    <div class="card-title">
                        <i class="fas fa-check-circle"></i>
                        Tasa de √âxito
                    </div>
                    <div class="metric-value" id="metric-success-rate">0%</div>
                    <div class="metric-label">Respuestas Exitosas</div>
                </div>
                <div class="card metric-card">
                    <div class="card-title">
                        <i class="fas fa-clock"></i>
                        Latencia
                    </div>
                    <div class="metric-value" id="metric-latency">0ms</div>
                    <div class="metric-label">Tiempo Promedio</div>
                    </div>
                </div>
                
            <!-- Charts Row 1 -->
            <div class="grid grid-2">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-chart-line"></i>
                            Requests en Tiempo Real
                    </div>
                        <div class="card-icon">üìä</div>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="requests-chart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-stopwatch"></i>
                            Latencia (ms)
                        </div>
                        <div class="card-icon">‚è±Ô∏è</div>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="latency-chart"></canvas>
                        </div>
                    </div>
                </div>
                </div>
                
            <!-- Charts Row 2 -->
            <div class="grid grid-2">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-list-ol"></i>
                            C√≥digos HTTP
                        </div>
                        <div class="card-icon">üî¢</div>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="http-codes-chart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-network-wired"></i>
                            Throughput (MB/s)
                        </div>
                        <div class="card-icon">üì°</div>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="throughput-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Metrics -->
            <div class="grid grid-3">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-microchip"></i>
                            Uso de CPU
                        </div>
                        <div class="card-icon">‚ö°</div>
                    </div>
                    <div class="card-body">
                        <div class="metric-value" id="cpu-usage" style="font-size: 2rem;">0%</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="cpu-progress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-memory"></i>
                            Uso de Memoria
                        </div>
                        <div class="card-icon">üíæ</div>
                    </div>
                    <div class="card-body">
                        <div class="metric-value" id="memory-usage" style="font-size: 2rem;">0%</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="memory-progress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-link"></i>
                            Conexiones Activas
                        </div>
                        <div class="card-icon">üîó</div>
                    </div>
                    <div class="card-body">
                        <div class="metric-value" id="active-connections" style="font-size: 2rem;">0</div>
                        <div class="metric-label">Conexiones Establecidas</div>
                    </div>
                </div>
                </div>
                
            <!-- Advanced Analysis Section -->
            <div class="grid grid-3" style="margin-top: 2rem;">
                <!-- Pattern Analysis -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-search"></i>
                            An√°lisis de Patrones
                        </div>
                        <div class="card-icon">üîç</div>
                    </div>
                    <div class="card-body">
                        <div id="pattern-analysis-content" style="min-height: 200px;">
                            <div style="color: var(--text-secondary); text-align: center; padding: 2rem;">
                                Esperando datos de an√°lisis...
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Auto-Tuning -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-sliders-h"></i>
                            Auto-Tuning
                    </div>
                        <div class="card-icon">üîß</div>
                    </div>
                    <div class="card-body">
                        <div id="auto-tuning-content" style="min-height: 200px;">
                            <div style="color: var(--text-secondary); text-align: center; padding: 2rem;">
                                Esperando ajustes autom√°ticos...
                            </div>
                </div>
            </div>
        </div>
        
                <!-- Security Analysis -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-shield-alt"></i>
                            An√°lisis de Seguridad
                        </div>
                        <div class="card-icon">üîí</div>
                    </div>
                    <div class="card-body">
                        <div id="security-analysis-content" style="min-height: 200px;">
                            <div style="color: var(--text-secondary); text-align: center; padding: 2rem;">
                                Esperando an√°lisis de seguridad...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Configuration Tab -->
        <div id="configuration" class="tab-content">
            <div class="grid grid-2">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-bullseye"></i>
                            Configuraci√≥n de Target
                        </div>
                    </div>
                    <div class="card-body">
                    <div class="form-group">
                            <label class="form-label">Target URL/IP</label>
                            <input type="text" class="form-input" id="config-target" placeholder="https://example.com">
                    </div>
                    <div class="form-group">
                            <label class="form-label">Duraci√≥n (segundos)</label>
                            <input type="number" class="form-input" id="config-duration" value="60" min="1">
                    </div>
                    <div class="form-group">
                            <label class="form-label">Nivel de Potencia</label>
                            <select class="form-select" id="config-power">
                                <option value="LIGHT">LIGHT (x2)</option>
                                <option value="MODERATE" selected>MODERATE (x8)</option>
                                <option value="HEAVY">HEAVY (x20)</option>
                                <option value="EXTREME">EXTREME (x50)</option>
                                <option value="GODMODE">GODMODE (x100)</option>
                        </select>
                    </div>
                    <div class="form-group">
                            <label class="form-label">Modo de Ataque</label>
                            <select class="form-select" id="config-mode">
                            <option value="MIXED" selected>MIXED</option>
                            <option value="CONSTANT">CONSTANT</option>
                            <option value="BURST">BURST</option>
                            <option value="RAMP_UP">RAMP_UP</option>
                        </select>
                    </div>
                        <button class="btn btn-secondary" onclick="runFingerprint()">
                            <i class="fas fa-fingerprint"></i>
                            Ejecutar Fingerprint
                        </button>
                </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-sliders-h"></i>
                            Configuraci√≥n Avanzada
                    </div>
                    </div>
                    <div class="card-body">
                    <div class="form-group">
                            <label class="form-label">Max Conexiones</label>
                            <input type="number" class="form-input" id="config-connections" value="10000" min="1">
                    </div>
                    <div class="form-group">
                            <label class="form-label">Max Threads</label>
                            <input type="number" class="form-input" id="config-threads" value="400" min="1">
                    </div>
                        <div class="form-checkbox">
                            <input type="checkbox" id="config-waf-bypass">
                            <label for="config-waf-bypass">WAF Bypass</label>
                    </div>
                        <div class="form-checkbox">
                            <input type="checkbox" id="config-stealth">
                            <label for="config-stealth">Modo Stealth</label>
                </div>
                        <div class="form-checkbox">
                            <input type="checkbox" id="config-large-payloads">
                            <label for="config-large-payloads">Payloads Grandes</label>
                    </div>
                        <div class="form-checkbox">
                            <input type="checkbox" id="config-auto-throttle" checked>
                            <label for="config-auto-throttle">Auto Throttle</label>
                    </div>
                        <div class="form-checkbox">
                            <input type="checkbox" id="config-memory-monitoring" checked>
                            <label for="config-memory-monitoring">Monitoreo de Memoria</label>
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-primary" onclick="saveConfig()">
                                <i class="fas fa-save"></i>
                                Guardar
                            </button>
                            <button class="btn btn-primary" onclick="startAttack()">
                                <i class="fas fa-play"></i>
                                Iniciar
                            </button>
                            <button class="btn btn-danger" onclick="stopAttack()">
                                <i class="fas fa-stop"></i>
                                Detener
                            </button>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header" onclick="toggleSection('advanced-network')" style="cursor: pointer;">
                        <div class="card-title">
                            <i class="fas fa-network-wired"></i>
                            Configuraci√≥n de Red y Timeouts
                    </div>
                        <i class="fas fa-chevron-down" id="advanced-network-icon"></i>
                    </div>
                    <div class="card-body" id="advanced-network" style="display: none;">
                        <div class="form-group">
                            <label class="form-label">Connect Timeout (segundos)</label>
                            <input type="number" class="form-input" id="config-connect-timeout" value="3.0" step="0.1" min="0.1">
                    </div>
                        <div class="form-group">
                            <label class="form-label">Read Timeout (segundos)</label>
                            <input type="number" class="form-input" id="config-read-timeout" value="6.0" step="0.1" min="0.1">
                    </div>
                        <div class="form-group">
                            <label class="form-label">Max Retries</label>
                            <input type="number" class="form-input" id="config-max-retries" value="0" min="0">
                    </div>
                    <div class="form-group">
                            <label class="form-label">Retry Backoff Factor</label>
                            <input type="number" class="form-input" id="config-retry-backoff" value="0.3" step="0.1" min="0">
                    </div>
                    <div class="form-group">
                            <label class="form-label">Connection Pool Size</label>
                            <input type="number" class="form-input" id="config-pool-size" value="1000" min="1">
                    </div>
                        <div class="form-group">
                            <label class="form-label">Max Payload Size (MB)</label>
                            <input type="number" class="form-input" id="config-max-payload-mb" value="10" min="1">
                </div>
                        <div class="form-checkbox">
                            <input type="checkbox" id="config-keep-alive" checked>
                            <label for="config-keep-alive">Keep-Alive Pooling</label>
                        </div>
                        <div class="form-checkbox">
                            <input type="checkbox" id="config-connection-warmup" checked>
                            <label for="config-connection-warmup">Connection Warmup</label>
                        </div>
                        <div class="form-checkbox">
                            <input type="checkbox" id="config-tcp-optimization" checked>
                            <label for="config-tcp-optimization">TCP Optimization</label>
                        </div>
                        <div class="form-checkbox">
                            <input type="checkbox" id="config-http2-multiplexing" checked>
                            <label for="config-http2-multiplexing">HTTP/2 Multiplexing</label>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header" onclick="toggleSection('advanced-analysis')" style="cursor: pointer;">
                        <div class="card-title">
                            <i class="fas fa-brain"></i>
                            An√°lisis Avanzado
                    </div>
                        <i class="fas fa-chevron-down" id="advanced-analysis-icon"></i>
                    </div>
                    <div class="card-body" id="advanced-analysis" style="display: none;">
                        <div class="form-checkbox">
                            <input type="checkbox" id="config-pattern-analysis" checked>
                            <label for="config-pattern-analysis">An√°lisis de Patrones en Respuestas</label>
                    </div>
                        <div class="form-checkbox">
                            <input type="checkbox" id="config-auto-tuning" checked>
                            <label for="config-auto-tuning">Auto-Tuning de Par√°metros</label>
                    </div>
                        <div class="form-checkbox">
                            <input type="checkbox" id="config-security-analysis" checked>
                            <label for="config-security-analysis">An√°lisis de Seguridad Durante Stress</label>
                    </div>
                </div>
            </div>
                <div class="card">
                    <div class="card-header" onclick="toggleSection('evasion-techniques')" style="cursor: pointer;">
                        <div class="card-title">
                            <i class="fas fa-shield-alt"></i>
                            T√©cnicas de Evasi√≥n
                </div>
                        <i class="fas fa-chevron-down" id="evasion-techniques-icon"></i>
            </div>
                    <div class="card-body" id="evasion-techniques" style="display: none;">
                        <div class="form-checkbox">
                            <input type="checkbox" id="evasion-url-encoding" checked>
                            <label for="evasion-url-encoding">URL Encoding</label>
        </div>
                        <div class="form-checkbox">
                            <input type="checkbox" id="evasion-case-variation" checked>
                            <label for="evasion-case-variation">Case Variation</label>
                    </div>
                        <div class="form-checkbox">
                            <input type="checkbox" id="evasion-parameter-pollution" checked>
                            <label for="evasion-parameter-pollution">Parameter Pollution</label>
                        </div>
                        <div class="form-checkbox">
                            <input type="checkbox" id="evasion-method-tampering" checked>
                            <label for="evasion-method-tampering">Method Tampering</label>
                        </div>
                        <div class="form-checkbox">
                            <input type="checkbox" id="evasion-header-injection" checked>
                            <label for="evasion-header-injection">Header Injection</label>
                    </div>
                        <div class="form-checkbox">
                            <input type="checkbox" id="evasion-host-header-injection" checked>
                            <label for="evasion-host-header-injection">Host Header Injection</label>
                </div>
                        <div class="form-checkbox">
                            <input type="checkbox" id="evasion-content-type-manipulation" checked>
                            <label for="evasion-content-type-manipulation">Content-Type Manipulation</label>
                    </div>
                        <div class="form-checkbox">
                            <input type="checkbox" id="evasion-null-byte-injection" checked>
                            <label for="evasion-null-byte-injection">Null Byte Injection</label>
                    </div>
                        <div class="form-checkbox">
                            <input type="checkbox" id="evasion-whitespace-injection" checked>
                            <label for="evasion-whitespace-injection">Whitespace Injection</label>
                    </div>
                        <div class="form-checkbox">
                            <input type="checkbox" id="evasion-path-traversal" checked>
                            <label for="evasion-path-traversal">Path Traversal Evasion</label>
                    </div>
                        <div class="form-checkbox">
                            <input type="checkbox" id="evasion-query-string-manipulation" checked>
                            <label for="evasion-query-string-manipulation">Query String Manipulation</label>
                    </div>
                        <div class="form-checkbox">
                            <input type="checkbox" id="evasion-cookie-manipulation" checked>
                            <label for="evasion-cookie-manipulation">Cookie Manipulation</label>
                    </div>
                    </div>
                    </div>
                </div>
            <div class="card" id="fingerprint-results" style="display: none;">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-info-circle"></i>
                        Resultados de Fingerprint
                    </div>
                </div>
                <div class="card-body" id="fingerprint-content"></div>
            </div>
            </div>
            
        <!-- Monitoring Tab -->
        <div id="monitoring" class="tab-content">
            <div class="grid grid-2">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-chart-bar"></i>
                            Estad√≠sticas de Latencia
                    </div>
                </div>
                    <div class="card-body">
                        <table class="table">
                            <tr>
                                <th>M√©trica</th>
                                <th>Valor</th>
                            </tr>
                            <tr>
                                <td>Promedio</td>
                                <td id="latency-avg">-</td>
                            </tr>
                            <tr>
                                <td>M√≠nimo</td>
                                <td id="latency-min">-</td>
                            </tr>
                            <tr>
                                <td>M√°ximo</td>
                                <td id="latency-max">-</td>
                            </tr>
                            <tr>
                                <td>P50</td>
                                <td id="latency-p50">-</td>
                            </tr>
                            <tr>
                                <td>P95</td>
                                <td id="latency-p95">-</td>
                            </tr>
                            <tr>
                                <td>P99</td>
                                <td id="latency-p99">-</td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-code"></i>
                            Distribuci√≥n de C√≥digos HTTP
                    </div>
                </div>
                    <div class="card-body" id="http-codes-distribution"></div>
            </div>
                </div>
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-terminal"></i>
                        Logs en Tiempo Real
            </div>
                </div>
                <div class="card-body">
                    <div id="logs-container" style="font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; max-height: 450px; overflow-y: auto; background: var(--bg-tertiary); padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border);">
                        <div style="color: var(--text-secondary); text-align: center;">Esperando logs...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
            <div class="grid grid-2">
                <!-- Historial de Ataques -->
                <div class="card" style="grid-column: 1 / -1;">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-history"></i>
                            Historial de Ataques
                        </div>
                        <button class="btn btn-secondary" onclick="loadHistory()">
                            <i class="fas fa-sync-alt"></i>
                            Actualizar
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="history-list" style="max-height: 600px; overflow-y: auto;"></div>
                    </div>
                </div>
                
                <!-- Reportes HTML Disponibles -->
            <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-file-alt"></i>
                            Reportes HTML Disponibles
                        </div>
                        <button class="btn btn-secondary" onclick="loadReports()">
                            <i class="fas fa-sync-alt"></i>
                            Actualizar
                        </button>
                    </div>
                    <div class="card-body">
                <div id="reports-list"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tools Tab -->
        <div id="tools" class="tab-content">
            <div class="grid grid-2">
            <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-tools"></i>
                            Estado de Herramientas
            </div>
                        <button class="btn btn-secondary" onclick="loadTools()">
                            <i class="fas fa-sync-alt"></i>
                            Actualizar
                        </button>
        </div>
                    <div class="card-body">
                        <div class="tools-grid" id="tools-grid"></div>
                            </div>
                        </div>
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-stethoscope"></i>
                            Autodiagn√≥stico del Sistema
                    </div>
                        <button class="btn btn-primary" onclick="runAutodiagnostic()">
                            <i class="fas fa-play"></i>
                            Ejecutar
                        </button>
                    </div>
                    <div class="card-body">
                        <div style="margin-bottom: 1rem; padding: 1rem; background: var(--bg-tertiary); border-radius: 12px; border: 1px solid var(--border);">
                            <div style="font-size: 0.9rem; color: var(--text-secondary); line-height: 1.6;">
                                El autodiagn√≥stico verifica todas las herramientas, dependencias, permisos y funciones cr√≠ticas del sistema. 
                                Ejecuta este diagn√≥stico antes de iniciar un ataque para asegurar que todo est√© funcionando correctamente.
                            </div>
                        </div>
                        <div class="card" id="autodiagnostic-results" style="display: none; margin-top: 1rem; background: var(--bg-tertiary); border: 1px solid var(--border);">
                            <div class="card-header">
                                <div class="card-title">
                                    <i class="fas fa-clipboard-list"></i>
                                    Resultados del Autodiagn√≥stico
                    </div>
                    </div>
                            <div class="card-body" id="autodiagnostic-content"></div>
                    </div>
                    </div>
                            </div>
                        </div>
                    </div>

        <!-- System Tab -->
        <div id="system" class="tab-content">
            <div class="grid grid-2">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-server"></i>
                            Informaci√≥n del Sistema
                    </div>
                </div>
                    <div class="card-body" id="system-info"></div>
            </div>
                    <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-chart-pie"></i>
                            Uso de Recursos
                    </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="system-resources-chart"></canvas>
                </div>
            </div>
        </div>
                </div>
            </div>
        </div>
        
    <script>
        // Global state
        let config = {};
        let stats = {};
        let charts = {};
        let updateInterval = null;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initTabs();
            initCharts();
            loadConfig();
            startUpdates();
        });
        
        // Tab Navigation
        function initTabs() {
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.dataset.tab;
                    
                    // Update active tab
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update active content
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    document.getElementById(tabName).classList.add('active');
                });
            });
        }
        
        // Initialize Charts
        function initCharts() {
            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: { 
                            color: '#b4b4c8',
                            font: { family: 'Inter', size: 12, weight: 600 }
                        }
                    }
                },
                scales: {
                    x: { 
                        ticks: { color: '#b4b4c8', font: { family: 'JetBrains Mono', size: 11 } },
                        grid: { color: '#2a2a3e' }
                    },
                    y: { 
                        ticks: { color: '#b4b4c8', font: { family: 'JetBrains Mono', size: 11 } },
                        grid: { color: '#2a2a3e' }
                    }
                }
            };
            
            // Requests Chart
            const requestsCtx = document.getElementById('requests-chart');
            if (requestsCtx) {
                charts.requests = new Chart(requestsCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Requests/s',
                            data: [],
                            borderColor: '#00ff88',
                            backgroundColor: 'rgba(0, 255, 136, 0.1)',
                            tension: 0.4,
                            fill: true,
                            borderWidth: 2,
                            pointRadius: 0,
                            pointHoverRadius: 4
                        }]
                    },
                    options: chartOptions
                });
            }
            
            // Latency Chart
            const latencyCtx = document.getElementById('latency-chart');
            if (latencyCtx) {
                charts.latency = new Chart(latencyCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Latencia (ms)',
                            data: [],
                            borderColor: '#00d9ff',
                            backgroundColor: 'rgba(0, 217, 255, 0.1)',
                            tension: 0.4,
                            fill: true,
                            borderWidth: 2,
                            pointRadius: 0,
                            pointHoverRadius: 4
                        }]
                    },
                    options: chartOptions
                });
            }
            
            // HTTP Codes Chart
            const httpCodesCtx = document.getElementById('http-codes-chart');
            if (httpCodesCtx) {
                charts.httpCodes = new Chart(httpCodesCtx, {
                    type: 'doughnut',
                    data: {
                        labels: [],
                        datasets: [{
                            data: [],
                            backgroundColor: [
                                '#00ff88',
                                '#00d9ff',
                                '#ffb800',
                                '#ff3366'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { 
                                    color: '#b4b4c8',
                                    font: { family: 'Inter', size: 12, weight: 600 },
                                    padding: 15
                                }
                            }
                        }
                    }
                });
            }
            
            // Throughput Chart
            const throughputCtx = document.getElementById('throughput-chart');
            if (throughputCtx) {
                charts.throughput = new Chart(throughputCtx, {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'MB/s',
                            data: [],
                            backgroundColor: '#ff6b35',
                            borderRadius: 8,
                            borderSkipped: false
                        }]
                    },
                    options: chartOptions
                });
            }
        }
        
        // Load Configuration
        async function loadConfig() {
            try {
                const response = await fetch('/api/config');
                config = await response.json();
                
                // Update form fields
                document.getElementById('config-target').value = config.target || '';
                document.getElementById('config-duration').value = config.duration || 60;
                document.getElementById('config-power').value = config.power_level || 'MODERATE';
                document.getElementById('config-mode').value = config.attack_mode || 'MIXED';
                document.getElementById('config-connections').value = config.max_connections || 10000;
                document.getElementById('config-threads').value = config.max_threads || 400;
                document.getElementById('config-waf-bypass').checked = config.waf_bypass || false;
                document.getElementById('config-stealth').checked = config.stealth_mode || false;
                document.getElementById('config-large-payloads').checked = config.use_large_payloads || false;
                document.getElementById('config-auto-throttle').checked = config.auto_throttle !== false;
                document.getElementById('config-memory-monitoring').checked = config.memory_monitoring !== false;
                
                // Configuraci√≥n de red y timeouts
                if (document.getElementById('config-connect-timeout')) {
                    document.getElementById('config-connect-timeout').value = config.connect_timeout || 3.0;
                }
                if (document.getElementById('config-read-timeout')) {
                    document.getElementById('config-read-timeout').value = config.read_timeout || 6.0;
                }
                if (document.getElementById('config-max-retries')) {
                    document.getElementById('config-max-retries').value = config.max_retries || 0;
                }
                if (document.getElementById('config-retry-backoff')) {
                    document.getElementById('config-retry-backoff').value = config.retry_backoff_factor || 0.3;
                }
                if (document.getElementById('config-pool-size')) {
                    document.getElementById('config-pool-size').value = config.connection_pool_size || 1000;
                }
                if (document.getElementById('config-max-payload-mb')) {
                    document.getElementById('config-max-payload-mb').value = config.max_payload_mb || 10;
                }
                if (document.getElementById('config-keep-alive')) {
                    document.getElementById('config-keep-alive').checked = config.keep_alive_pooling !== false;
                }
                if (document.getElementById('config-connection-warmup')) {
                    document.getElementById('config-connection-warmup').checked = config.connection_warmup !== false;
                }
                if (document.getElementById('config-tcp-optimization')) {
                    document.getElementById('config-tcp-optimization').checked = config.tcp_optimization !== false;
                }
                if (document.getElementById('config-http2-multiplexing')) {
                    document.getElementById('config-http2-multiplexing').checked = config.http2_multiplexing !== false;
                }
                
                // An√°lisis avanzado
                if (document.getElementById('config-pattern-analysis')) {
                    document.getElementById('config-pattern-analysis').checked = config.pattern_analysis_enabled !== false;
                }
                if (document.getElementById('config-auto-tuning')) {
                    document.getElementById('config-auto-tuning').checked = config.auto_tuning_enabled !== false;
                }
                if (document.getElementById('config-security-analysis')) {
                    document.getElementById('config-security-analysis').checked = config.security_analysis_enabled !== false;
                }
                
                // An√°lisis avanzado
                if (document.getElementById('config-pattern-analysis')) {
                    document.getElementById('config-pattern-analysis').checked = config.pattern_analysis_enabled !== false;
                }
                if (document.getElementById('config-auto-tuning')) {
                    document.getElementById('config-auto-tuning').checked = config.auto_tuning_enabled !== false;
                }
                if (document.getElementById('config-security-analysis')) {
                    document.getElementById('config-security-analysis').checked = config.security_analysis_enabled !== false;
                }
                
                // T√©cnicas de evasi√≥n
                const evasionTechniques = config.evasion_techniques || {};
                if (document.getElementById('evasion-url-encoding')) {
                    document.getElementById('evasion-url-encoding').checked = evasionTechniques.url_encoding !== false;
                }
                if (document.getElementById('evasion-case-variation')) {
                    document.getElementById('evasion-case-variation').checked = evasionTechniques.case_variation !== false;
                }
                if (document.getElementById('evasion-parameter-pollution')) {
                    document.getElementById('evasion-parameter-pollution').checked = evasionTechniques.parameter_pollution !== false;
                }
                if (document.getElementById('evasion-method-tampering')) {
                    document.getElementById('evasion-method-tampering').checked = evasionTechniques.method_tampering !== false;
                }
                if (document.getElementById('evasion-header-injection')) {
                    document.getElementById('evasion-header-injection').checked = evasionTechniques.header_injection !== false;
                }
                if (document.getElementById('evasion-host-header-injection')) {
                    document.getElementById('evasion-host-header-injection').checked = evasionTechniques.host_header_injection !== false;
                }
                if (document.getElementById('evasion-content-type-manipulation')) {
                    document.getElementById('evasion-content-type-manipulation').checked = evasionTechniques.content_type_manipulation !== false;
                }
                if (document.getElementById('evasion-null-byte-injection')) {
                    document.getElementById('evasion-null-byte-injection').checked = evasionTechniques.null_byte_injection !== false;
                }
                if (document.getElementById('evasion-whitespace-injection')) {
                    document.getElementById('evasion-whitespace-injection').checked = evasionTechniques.whitespace_injection !== false;
                }
                if (document.getElementById('evasion-path-traversal')) {
                    document.getElementById('evasion-path-traversal').checked = evasionTechniques.path_traversal_evasion !== false;
                }
                if (document.getElementById('evasion-query-string-manipulation')) {
                    document.getElementById('evasion-query-string-manipulation').checked = evasionTechniques.query_string_manipulation !== false;
                }
                if (document.getElementById('evasion-cookie-manipulation')) {
                    document.getElementById('evasion-cookie-manipulation').checked = evasionTechniques.cookie_manipulation !== false;
                }
            } catch (error) {
                console.error('Error loading config:', error);
            }
        }
        
        // Save Configuration
        async function saveConfig() {
            const newConfig = {
                target: document.getElementById('config-target').value,
                duration: parseInt(document.getElementById('config-duration').value),
                power_level: document.getElementById('config-power').value,
                attack_mode: document.getElementById('config-mode').value,
                max_connections: parseInt(document.getElementById('config-connections').value),
                max_threads: parseInt(document.getElementById('config-threads').value),
                waf_bypass: document.getElementById('config-waf-bypass').checked,
                stealth_mode: document.getElementById('config-stealth').checked,
                use_large_payloads: document.getElementById('config-large-payloads').checked,
                auto_throttle: document.getElementById('config-auto-throttle').checked,
                memory_monitoring: document.getElementById('config-memory-monitoring').checked,
                // An√°lisis avanzado
                pattern_analysis_enabled: document.getElementById('config-pattern-analysis') ? document.getElementById('config-pattern-analysis').checked : true,
                auto_tuning_enabled: document.getElementById('config-auto-tuning') ? document.getElementById('config-auto-tuning').checked : true,
                security_analysis_enabled: document.getElementById('config-security-analysis') ? document.getElementById('config-security-analysis').checked : true
            };
            
            try {
                const response = await fetch('/api/config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newConfig)
                });
                
                if (response.ok) {
                    showAlert('Configuraci√≥n guardada exitosamente', 'success');
                    config = newConfig;
                } else {
                    showAlert('Error al guardar configuraci√≥n', 'error');
                }
            } catch (error) {
                showAlert('Error al guardar configuraci√≥n: ' + error.message, 'error');
            }
        }
        
        // Start Attack
        async function startAttack() {
            await saveConfig();
            
            try {
                const response = await fetch('/api/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showAlert('Ataque iniciado exitosamente', 'success');
                    updateAttackStatus(true);
                } else {
                    showAlert(result.message || 'Error al iniciar ataque', 'error');
                }
            } catch (error) {
                showAlert('Error al iniciar ataque: ' + error.message, 'error');
            }
        }
        
        // Stop Attack
        async function stopAttack() {
            try {
                const response = await fetch('/api/stop', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showAlert('Ataque detenido', 'success');
                    updateAttackStatus(false);
                } else {
                    showAlert(result.message || 'Error al detener ataque', 'error');
                }
            } catch (error) {
                showAlert('Error al detener ataque: ' + error.message, 'error');
            }
        }
        
        // Run Fingerprint
        async function runFingerprint() {
            const target = document.getElementById('config-target').value;
            if (!target) {
                showAlert('Por favor ingresa un target', 'warning');
                return;
            }
            
            const container = document.getElementById('fingerprint-results');
            const content = document.getElementById('fingerprint-content');
            
            // Mostrar estado de progreso
            content.innerHTML = `
                <div style="text-align: center; padding: 3rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem; color: var(--primary);">
                        <i class="fas fa-spinner fa-spin"></i>
                    </div>
                    <div style="font-size: 1.2rem; color: var(--primary); margin-bottom: 0.5rem; font-weight: 600;">
                        Analizando Target...
                    </div>
                    <div style="color: var(--text-secondary); font-size: 0.9rem;">
                        <div id="fingerprint-progress">Iniciando an√°lisis...</div>
                    </div>
                </div>
            `;
            container.style.display = 'block';
            
            try {
                showAlert('Ejecutando fingerprint...', 'info');
                
                // Simular progreso mientras se ejecuta
                const progressMessages = [
                    'Validando target...',
                    'Escaneando puertos...',
                    'Descubriendo endpoints...',
                    'Analizando respuesta HTTP...',
                    'Detectando framework...',
                    'Analizando security headers...',
                    'Escaneando vulnerabilidades...',
                    'Detectando CDN y WAF...',
                    'Generando reporte...'
                ];
                
                let progressIndex = 0;
                const progressInterval = setInterval(() => {
                    if (progressIndex < progressMessages.length) {
                        const progressEl = document.getElementById('fingerprint-progress');
                        if (progressEl) {
                            progressEl.textContent = progressMessages[progressIndex];
                        }
                        progressIndex++;
                    }
                }, 800);
                
                const response = await fetch('/api/fingerprint', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ target })
                });
                
                clearInterval(progressInterval);
                
                const result = await response.json();
                
                if (response.ok) {
                    displayFingerprint(result.fingerprint, result.stress_recommendations, result.tool_recommendations, result.fingerprint_status);
                    showAlert('Fingerprint completado exitosamente', 'success');
                } else {
                    content.innerHTML = `
                        <div style="text-align: center; padding: 3rem; color: var(--danger);">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                            <div style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem;">Error en Fingerprint</div>
                            <div style="color: var(--text-secondary);">${result.message || 'Error desconocido'}</div>
                        </div>
                    `;
                    showAlert(result.message || 'Error en fingerprint', 'error');
                }
            } catch (error) {
                content.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--danger);">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                        <div style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem;">Error de Conexi√≥n</div>
                        <div style="color: var(--text-secondary);">${error.message}</div>
                    </div>
                `;
                showAlert('Error: ' + error.message, 'error');
            }
        }
        
        // Variables globales para recomendaciones
        let currentFingerprint = null;
        let currentStressRecommendations = null;
        let currentToolRecommendations = null;
        
        // Display Fingerprint Results
        function displayFingerprint(fingerprint, stressRecommendations, toolRecommendations, status) {
            // Guardar recomendaciones globalmente
            currentFingerprint = fingerprint;
            currentStressRecommendations = stressRecommendations;
            currentToolRecommendations = toolRecommendations;
            
            const container = document.getElementById('fingerprint-results');
            const content = document.getElementById('fingerprint-content');
            
            const completedAt = fingerprint?.completed_at ? new Date(fingerprint.completed_at).toLocaleString('es-ES') : new Date().toLocaleString('es-ES');
            const statusBadge = status === 'completed' 
                ? '<span style="background: var(--success); color: #000; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600;"><i class="fas fa-check-circle"></i> Completado</span>'
                : '<span style="background: var(--warning); color: #000; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600;"><i class="fas fa-clock"></i> En Progreso</span>';
            
            let html = `
                <div style="margin-bottom: 1.5rem; display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: var(--bg-tertiary); border-radius: 12px; border: 1px solid var(--border);">
                    <div>
                        <div style="font-size: 1.1rem; font-weight: 600; color: var(--primary); margin-bottom: 0.25rem;">
                            <i class="fas fa-fingerprint"></i> An√°lisis de Target
                        </div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">
                            <i class="fas fa-calendar"></i> ${completedAt}
                        </div>
                    </div>
                    ${statusBadge}
                </div>
            `;
            
            html += '<div class="grid grid-2" style="gap: 1.5rem;">';
            
            if (fingerprint) {
                html += `
                    <div class="card" style="background: var(--bg-card); border: 1px solid var(--border); padding: 1.5rem; border-radius: 12px;">
                        <h3 style="margin-bottom: 1.5rem; color: var(--primary); font-size: 1.2rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-info-circle"></i> Informaci√≥n del Target
                        </h3>
                        <div style="display: grid; gap: 1rem;">
                `;
                
                const infoFields = [
                    { key: 'target', label: 'Target', icon: 'fa-bullseye', color: 'var(--primary)' },
                    { key: 'domain', label: 'Dominio', icon: 'fa-globe', color: 'var(--secondary)' },
                    { key: 'ip_address', label: 'IP Address', icon: 'fa-network-wired', color: 'var(--info)' },
                    { key: 'protocol', label: 'Protocolo', icon: 'fa-shield-alt', color: 'var(--primary)' },
                    { key: 'port', label: 'Puerto', icon: 'fa-plug', color: 'var(--secondary)' },
                    { key: 'target_type', label: 'Tipo', icon: 'fa-tag', color: 'var(--info)' },
                    { key: 'network_type', label: 'Red', icon: 'fa-sitemap', color: 'var(--primary)' },
                    { key: 'server', label: 'Servidor', icon: 'fa-server', color: 'var(--secondary)' },
                    { key: 'framework', label: 'Framework', icon: 'fa-code', color: 'var(--info)' },
                    { key: 'waf', label: 'WAF', icon: 'fa-shield-virus', color: fingerprint.waf ? 'var(--warning)' : 'var(--success)' },
                    { key: 'cdn', label: 'CDN', icon: 'fa-cloud', color: fingerprint.cdn ? 'var(--info)' : 'var(--text-muted)' }
                ];
                
                for (const field of infoFields) {
                    const value = fingerprint[field.key];
                    if (value !== undefined && value !== null && value !== '') {
                        html += `
                            <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: var(--bg-tertiary); border-radius: 8px; border-left: 3px solid ${field.color};">
                                <i class="fas ${field.icon}" style="color: ${field.color}; font-size: 1.1rem; width: 24px;"></i>
                                <div style="flex: 1;">
                                    <div style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.25rem;">${field.label}</div>
                                    <div style="font-size: 0.95rem; color: var(--text-primary); font-weight: 500;">${Array.isArray(value) ? value.join(', ') : value}</div>
                                </div>
                            </div>
                        `;
                    }
                }
                
                if (fingerprint.technologies && fingerprint.technologies.length > 0) {
                    html += `
                        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">
                            <div style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.5rem;">Tecnolog√≠as Detectadas</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                    `;
                    fingerprint.technologies.forEach(tech => {
                        html += `<span style="background: var(--bg-tertiary); color: var(--primary); padding: 0.25rem 0.75rem; border-radius: 6px; font-size: 0.8rem; border: 1px solid var(--border);">${tech}</span>`;
                    });
                    html += `</div></div>`;
                }
                
                html += '</div></div>';
            }
            
            if (stressRecommendations) {
                html += `
                    <div class="card" style="background: var(--bg-card); border: 1px solid var(--border); padding: 1.5rem; border-radius: 12px;">
                        <h3 style="margin-bottom: 1.5rem; color: var(--secondary); font-size: 1.2rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-lightbulb"></i> Recomendaciones de Configuraci√≥n
                        </h3>
                        <div style="display: grid; gap: 1rem;">
                            <div style="padding: 1rem; background: linear-gradient(135deg, rgba(0, 255, 136, 0.1) 0%, rgba(0, 217, 255, 0.1) 100%); border-radius: 8px; border: 1px solid var(--border-glow);">
                                <div style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.5rem;">Nivel de Potencia Recomendado</div>
                                <div style="font-size: 1.3rem; color: var(--primary); font-weight: 700;">${stressRecommendations.recommended_power_level || 'N/A'}</div>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                                <div style="padding: 1rem; background: var(--bg-tertiary); border-radius: 8px; border: 1px solid var(--border);">
                                    <div style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.5rem;">Conexiones</div>
                                    <div style="font-size: 1.1rem; color: var(--primary); font-weight: 600;">${stressRecommendations.recommended_connections || 'N/A'}</div>
                                </div>
                                <div style="padding: 1rem; background: var(--bg-tertiary); border-radius: 8px; border: 1px solid var(--border);">
                                    <div style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.5rem;">Threads</div>
                                    <div style="font-size: 1.1rem; color: var(--secondary); font-weight: 600;">${stressRecommendations.recommended_threads || 'N/A'}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Mostrar recomendaciones de herramientas si existen
            if (toolRecommendations && Object.keys(toolRecommendations).length > 0) {
                html += `
                    <div class="card" style="grid-column: 1 / -1; background: var(--bg-card); border: 1px solid var(--primary); padding: 1.5rem; border-radius: 12px; margin-top: 1.5rem;">
                        <h3 style="margin-bottom: 1.5rem; color: var(--primary); font-size: 1.2rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-tools"></i> Recomendaciones de Herramientas
                        </h3>
                        <div style="display: grid; gap: 1rem;">
                `;
                
                if (toolRecommendations.recommended_tools && toolRecommendations.recommended_tools.length > 0) {
                    html += `
                        <div style="padding: 1rem; background: linear-gradient(135deg, rgba(0, 255, 136, 0.1) 0%, rgba(0, 217, 255, 0.1) 100%); border-radius: 8px; border: 1px solid var(--border-glow);">
                            <div style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.5rem;">Herramientas Recomendadas (${toolRecommendations.tool_count || toolRecommendations.recommended_tools.length})</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                    `;
                    toolRecommendations.recommended_tools.forEach(tool => {
                        html += `
                            <span style="padding: 0.5rem 1rem; background: var(--bg-tertiary); border-radius: 6px; border: 1px solid var(--border); font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; color: var(--primary);">
                                ${tool}
                            </span>
                        `;
                    });
                    html += `</div></div>`;
                }
                
                if (toolRecommendations.reasoning) {
                    html += `
                        <div style="padding: 1rem; background: var(--bg-tertiary); border-radius: 8px; border: 1px solid var(--border);">
                            <div style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.75rem;">Razonamiento</div>
                            <div style="color: var(--text-primary);">
                    `;
                    // Manejar tanto string como array
                    if (Array.isArray(toolRecommendations.reasoning)) {
                        html += `<ul style="margin: 0; padding-left: 1.5rem;">`;
                        toolRecommendations.reasoning.forEach(reason => {
                            html += `<li style="margin-bottom: 0.5rem; font-size: 0.9rem;">${reason}</li>`;
                        });
                        html += `</ul>`;
                        } else {
                        // Si es string, dividir por punto y coma o mostrar directamente
                        const reasoningText = String(toolRecommendations.reasoning);
                        if (reasoningText.includes('; ')) {
                            const reasons = reasoningText.split('; ');
                            html += `<ul style="margin: 0; padding-left: 1.5rem;">`;
                            reasons.forEach(reason => {
                                if (reason.trim()) {
                                    html += `<li style="margin-bottom: 0.5rem; font-size: 0.9rem;">${reason.trim()}</li>`;
                                }
                            });
                            html += `</ul>`;
                    } else {
                            html += `<div style="font-size: 0.9rem; line-height: 1.6;">${reasoningText}</div>`;
                        }
                    }
                    html += `</div></div>`;
                }
                
                // Bot√≥n para lanzar stress recomendado
                if (toolRecommendations.optimal_parameters || stressRecommendations) {
                    html += `
                        <div style="padding: 1.5rem; background: linear-gradient(135deg, rgba(0, 255, 136, 0.15) 0%, rgba(0, 217, 255, 0.15) 100%); border-radius: 12px; border: 2px solid var(--primary); margin-top: 1rem;">
                            <div style="display: flex; flex-direction: column; gap: 1rem;">
                                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <h4 style="margin: 0; color: var(--primary); font-size: 1.1rem; font-weight: 600; display: flex; align-items: center; gap: 0.5rem;">
                                        <i class="fas fa-rocket"></i> Lanzar Stress Recomendado
                                    </h4>
                                    <span style="background: var(--primary); color: #000; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600;">
                                        ${toolRecommendations.expected_sessions || '40,000-60,000+'} sesiones esperadas
                                    </span>
                                </div>
                                
                                <div id="recommended-command-container" style="display: none; margin-bottom: 1rem;">
                                    <div style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.5rem;">Comando para Replicar</div>
                                    <div style="position: relative;">
                                        <pre id="recommended-command" style="background: var(--bg-primary); border: 1px solid var(--border); border-radius: 8px; padding: 1rem; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; color: var(--primary); margin: 0; overflow-x: auto; word-break: break-all; white-space: pre-wrap;">Cargando comando...</pre>
                                        <button onclick="copyRecommendedCommand()" style="position: absolute; top: 0.5rem; right: 0.5rem; background: var(--primary); color: #000; border: none; border-radius: 6px; padding: 0.5rem 1rem; font-size: 0.75rem; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 0.5rem;" onmouseover="this.style.background='var(--secondary)'" onmouseout="this.style.background='var(--primary)'">
                                            <i class="fas fa-copy"></i> Copiar
                                        </button>
                                    </div>
                                </div>
                                
                                <div style="display: flex; gap: 1rem;">
                                    <button onclick="showRecommendedCommand()" style="flex: 1; background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border); border-radius: 8px; padding: 0.75rem 1.5rem; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 0.5rem;" onmouseover="this.style.background='var(--bg-secondary)'; this.style.borderColor='var(--primary)'" onmouseout="this.style.background='var(--bg-tertiary)'; this.style.borderColor='var(--border)'">
                                        <i class="fas fa-terminal"></i> Ver Comando
                                    </button>
                                    <button id="launch-recommended-btn" onclick="launchRecommendedAttack()" style="flex: 2; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); color: #000; border: none; border-radius: 8px; padding: 0.75rem 1.5rem; font-size: 0.9rem; font-weight: 700; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 0.5rem; box-shadow: 0 4px 12px rgba(0, 255, 136, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(0, 255, 136, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0, 255, 136, 0.3)'">
                                        <i class="fas fa-rocket"></i> Lanzar Stress Recomendado
                                    </button>
                                    <button id="stop-recommended-btn" onclick="stopRecommendedAttack()" style="display: none; flex: 1; background: linear-gradient(135deg, var(--danger) 0%, #ff4444 100%); color: #fff; border: none; border-radius: 8px; padding: 0.75rem 1.5rem; font-size: 0.9rem; font-weight: 700; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 0.5rem; box-shadow: 0 4px 12px rgba(255, 68, 68, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(255, 68, 68, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(255, 68, 68, 0.3)'">
                                        <i class="fas fa-stop"></i> Detener Stress
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                html += `</div></div>`;
            }
            
            // Vulnerabilidades si existen
            if (fingerprint && fingerprint.vulnerabilities && fingerprint.vulnerabilities.length > 0) {
                html += `
                    <div class="card" style="grid-column: 1 / -1; background: var(--bg-card); border: 1px solid var(--danger); padding: 1.5rem; border-radius: 12px;">
                        <h3 style="margin-bottom: 1rem; color: var(--danger); font-size: 1.2rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-exclamation-triangle"></i> Vulnerabilidades Detectadas (${fingerprint.vulnerabilities.length})
                        </h3>
                        <div style="display: grid; gap: 0.75rem;">
                `;
                fingerprint.vulnerabilities.slice(0, 5).forEach(vuln => {
                    const severityColor = vuln.severity === 'HIGH' ? 'var(--danger)' : vuln.severity === 'MEDIUM' ? 'var(--warning)' : 'var(--info)';
                    html += `
                        <div style="padding: 1rem; background: var(--bg-tertiary); border-radius: 8px; border-left: 3px solid ${severityColor};">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                                <div style="font-weight: 600; color: var(--text-primary);">${vuln.title || 'Vulnerabilidad'}</div>
                                <span style="background: ${severityColor}; color: #000; padding: 0.25rem 0.5rem; border-radius: 6px; font-size: 0.7rem; font-weight: 600;">${vuln.severity || 'UNKNOWN'}</span>
                            </div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary);">${vuln.description || 'Sin descripci√≥n'}</div>
                        </div>
                    `;
                });
                html += '</div></div>';
            }
            
            html += '</div>';
            content.innerHTML = html;
            container.style.display = 'block';
        }
        
        // Mostrar comando recomendado
        async function showRecommendedCommand() {
            const container = document.getElementById('recommended-command-container');
            const commandElement = document.getElementById('recommended-command');
            
            if (!container || !commandElement) {
                showAlert('Elementos no encontrados', 'error');
                return;
            }
            
            if (!currentToolRecommendations && !currentStressRecommendations) {
                showAlert('No hay recomendaciones disponibles', 'error');
                return;
            }
            
            try {
                commandElement.textContent = 'Generando comando...';
                container.style.display = 'block';
                
                const response = await fetch('/api/generate-command', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        tool_recommendations: currentToolRecommendations,
                        stress_recommendations: currentStressRecommendations,
                        target: currentFingerprint?.target || document.getElementById('target-input')?.value || ''
                    })
                });
                
                const result = await response.json();
                
                if (response.ok && result.command) {
                    commandElement.textContent = result.command;
                    showAlert('Comando generado correctamente', 'success');
                        } else {
                    commandElement.textContent = 'Error: ' + (result.message || 'Error generando comando');
                    showAlert(result.message || 'Error generando comando', 'error');
                }
            } catch (error) {
                commandElement.textContent = 'Error: ' + error.message;
                showAlert('Error: ' + error.message, 'error');
            }
        }
        
        // Detener ataque recomendado
        async function stopRecommendedAttack() {
            if (!confirm('¬øDesea detener el stress recomendado actual?')) {
                return;
            }
            
            try {
                showAlert('Deteniendo ataque...', 'info');
                
                const response = await fetch('/api/stop', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    // Ocultar bot√≥n de detener y mostrar bot√≥n de lanzar
                    const launchBtn = document.getElementById('launch-recommended-btn');
                    const stopBtn = document.getElementById('stop-recommended-btn');
                    if (launchBtn) launchBtn.style.display = 'flex';
                    if (stopBtn) stopBtn.style.display = 'none';
                    
                    showAlert('Ataque detenido correctamente', 'success');
                } else {
                    showAlert(result.message || 'Error deteniendo ataque', 'error');
                }
            } catch (error) {
                showAlert('Error: ' + error.message, 'error');
            }
        }
        
        // Copiar comando al portapapeles
        async function copyRecommendedCommand() {
            const commandElement = document.getElementById('recommended-command');
            if (!commandElement) return;
            
            try {
                await navigator.clipboard.writeText(commandElement.textContent);
                showAlert('Comando copiado al portapapeles', 'success');
                
                // Feedback visual
                const button = event.target.closest('button');
                if (button) {
                    const originalHTML = button.innerHTML;
                    button.innerHTML = '<i class="fas fa-check"></i> Copiado';
                    button.style.background = 'var(--success)';
                    setTimeout(() => {
                        button.innerHTML = originalHTML;
                        button.style.background = 'var(--primary)';
                    }, 2000);
                }
            } catch (error) {
                // Fallback para navegadores antiguos
                const textArea = document.createElement('textarea');
                textArea.value = commandElement.textContent;
                textArea.style.position = 'fixed';
                textArea.style.opacity = '0';
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    showAlert('Comando copiado al portapapeles', 'success');
                } catch (err) {
                    showAlert('Error al copiar comando', 'error');
                }
                document.body.removeChild(textArea);
            }
        }
        
        // Lanzar ataque recomendado
        async function launchRecommendedAttack() {
            if (!currentToolRecommendations && !currentStressRecommendations) {
                showAlert('No hay recomendaciones disponibles', 'error');
                return;
            }
            
            const target = currentFingerprint?.target || document.getElementById('target-input')?.value || '';
            if (!target) {
                showAlert('Target no especificado', 'error');
                return;
            }
            
            // Confirmar acci√≥n
            if (!confirm('¬øDesea lanzar el stress recomendado con los par√°metros optimizados?\n\nEsto iniciar√° un ataque con la configuraci√≥n recomendada basada en el fingerprint.')) {
                return;
            }
            
            try {
                showAlert('Iniciando ataque recomendado...', 'info');
                
                const response = await fetch('/api/start-recommended', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        tool_recommendations: currentToolRecommendations,
                        stress_recommendations: currentStressRecommendations,
                        target: target
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    // Mostrar comando usado
                    if (result.command) {
                        const container = document.getElementById('recommended-command-container');
                        const commandElement = document.getElementById('recommended-command');
                        if (container && commandElement) {
                            commandElement.textContent = result.command;
                            container.style.display = 'block';
                        }
                    }
                    
                    // Mostrar bot√≥n de detener y ocultar bot√≥n de lanzar
                    const launchBtn = document.getElementById('launch-recommended-btn');
                    const stopBtn = document.getElementById('stop-recommended-btn');
                    if (launchBtn) launchBtn.style.display = 'none';
                    if (stopBtn) stopBtn.style.display = 'flex';
                    
                    showAlert('Ataque recomendado iniciado correctamente', 'success');
                    
                    // Cambiar a pesta√±a Dashboard
                    const dashboardTab = document.querySelector('[data-tab="dashboard"]');
                    if (dashboardTab) {
                        dashboardTab.click();
                    }
                } else {
                    showAlert(result.message || 'Error iniciando ataque', 'error');
                }
            } catch (error) {
                showAlert('Error: ' + error.message, 'error');
            }
        }
        
        // Update Stats
        async function updateStats() {
            try {
                const response = await fetch('/api/stats');
                stats = await response.json();
                
                // Update header stats
                document.getElementById('header-requests').textContent = formatNumber(stats.requests_sent || 0);
                document.getElementById('header-rps').textContent = formatNumber(stats.rps?.current || 0);
                document.getElementById('header-errors').textContent = formatNumber(stats.errors || 0);
                
                // Update metrics
                document.getElementById('metric-requests').textContent = formatNumber(stats.requests_sent || 0);
                document.getElementById('metric-rps').textContent = formatNumber(stats.rps?.current || 0);
                document.getElementById('metric-success-rate').textContent = (stats.rates?.success_rate || 0).toFixed(1) + '%';
                document.getElementById('metric-latency').textContent = Math.round(stats.latency_stats?.avg || 0) + 'ms';
                
                // Update charts
                updateCharts();
                
                // Update latency stats - mejorado con validaci√≥n
                if (stats.latency_stats && Object.keys(stats.latency_stats).length > 0) {
                    const latency = stats.latency_stats;
                    // Validar que los valores sean n√∫meros v√°lidos
                    const formatLatency = (val) => {
                        if (val === null || val === undefined || isNaN(val) || val < 0) return '-';
                        return Math.round(val) + 'ms';
                    };
                    
                    document.getElementById('latency-avg').textContent = formatLatency(latency.avg);
                    document.getElementById('latency-min').textContent = formatLatency(latency.min);
                    document.getElementById('latency-max').textContent = formatLatency(latency.max);
                    document.getElementById('latency-p50').textContent = formatLatency(latency.p50);
                    document.getElementById('latency-p95').textContent = formatLatency(latency.p95);
                    document.getElementById('latency-p99').textContent = formatLatency(latency.p99);
                } else {
                    // Si no hay datos, mostrar guiones
                    document.getElementById('latency-avg').textContent = '-';
                    document.getElementById('latency-min').textContent = '-';
                    document.getElementById('latency-max').textContent = '-';
                    document.getElementById('latency-p50').textContent = '-';
                    document.getElementById('latency-p95').textContent = '-';
                    document.getElementById('latency-p99').textContent = '-';
                }
                
                // Update HTTP codes distribution
                updateHttpCodesDistribution(stats.http_codes || {});
                
                // Update system metrics
                if (stats.memory) {
                    document.getElementById('memory-usage').textContent = Math.round(stats.memory.percent || 0) + '%';
                    document.getElementById('memory-progress').style.width = (stats.memory.percent || 0) + '%';
                }
                
                // Update attack status
                updateAttackStatus(stats.monitoring_active || false);
                
                // Actualizar botones de lanzar/detener seg√∫n estado
                const launchBtn = document.getElementById('launch-recommended-btn');
                const stopBtn = document.getElementById('stop-recommended-btn');
                if (launchBtn && stopBtn) {
                    if (stats.monitoring_active) {
                        launchBtn.style.display = 'none';
                        stopBtn.style.display = 'flex';
                    } else {
                        launchBtn.style.display = 'flex';
                        stopBtn.style.display = 'none';
                    }
                }
                
                // Update Pattern Analysis
                updatePatternAnalysis(stats.pattern_analysis || {});
                
                // Update Auto-Tuning
                updateAutoTuning(stats.auto_tuning || {});
                
                // Update Security Analysis
                updateSecurityAnalysis(stats.security_analysis || {});
                
            } catch (error) {
                console.error('Error updating stats:', error);
            }
        }
        
        // Update Pattern Analysis Display
        function updatePatternAnalysis(patternData) {
            const container = document.getElementById('pattern-analysis-content');
            if (!container) return;
            
            if (!patternData || Object.keys(patternData).length === 0) {
                container.innerHTML = '<div style="color: var(--text-secondary); text-align: center; padding: 2rem;">Esperando datos de an√°lisis...</div>';
                return;
            }
            
            const detectedPatterns = patternData.detected_patterns || [];
            const recentPatterns = detectedPatterns.slice(-5).reverse(); // √öltimos 5, m√°s recientes primero
            const anomalies = patternData.anomalies || [];
            const recentAnomalies = anomalies.slice(-3).reverse(); // √öltimas 3
            
            let html = '';
            
            if (recentPatterns.length > 0) {
                html += '<div style="margin-bottom: 1.5rem;">';
                html += '<div style="font-size: 0.85rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.75rem;">Patrones Detectados</div>';
                recentPatterns.forEach(pattern => {
                    const severityColor = pattern.severity === 'high' ? 'var(--danger)' : pattern.severity === 'medium' ? 'var(--warning)' : 'var(--info)';
                html += `
                        <div style="padding: 0.75rem; background: var(--bg-tertiary); border-radius: 8px; border-left: 3px solid ${severityColor}; margin-bottom: 0.5rem;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.25rem;">
                                <div style="font-weight: 600; color: var(--text-primary); font-size: 0.9rem;">${pattern.type || 'Patr√≥n'}</div>
                                <span style="background: ${severityColor}; color: #000; padding: 0.2rem 0.4rem; border-radius: 4px; font-size: 0.7rem; font-weight: 600;">${pattern.severity || 'info'}</span>
                        </div>
                            <div style="font-size: 0.8rem; color: var(--text-secondary);">${(pattern.description || '').substring(0, 60)}${(pattern.description || '').length > 60 ? '...' : ''}</div>
                    </div>
                `;
            });
            html += '</div>';
            }
            
            if (recentAnomalies.length > 0) {
                html += '<div>';
                html += '<div style="font-size: 0.85rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.75rem;">Anomal√≠as</div>';
                recentAnomalies.forEach(anomaly => {
                    html += `
                        <div style="padding: 0.75rem; background: var(--bg-tertiary); border-radius: 8px; border-left: 3px solid var(--warning); margin-bottom: 0.5rem;">
                            <div style="font-weight: 600; color: var(--warning); font-size: 0.9rem; margin-bottom: 0.25rem;">${anomaly.type || 'Anomal√≠a'}</div>
                            <div style="font-size: 0.8rem; color: var(--text-secondary);">${(anomaly.description || '').substring(0, 50)}${(anomaly.description || '').length > 50 ? '...' : ''}</div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            if (html === '') {
                html = '<div style="color: var(--text-secondary); text-align: center; padding: 2rem;">No se han detectado patrones a√∫n</div>';
            }
            
            container.innerHTML = html;
        }
        
        // Update Auto-Tuning Display
        function updateAutoTuning(tuningData) {
            const container = document.getElementById('auto-tuning-content');
            if (!container) return;
            
            if (!tuningData || Object.keys(tuningData).length === 0) {
                container.innerHTML = '<div style="color: var(--text-secondary); text-align: center; padding: 2rem;">Esperando ajustes autom√°ticos...</div>';
                return;
            }
            
            const adjustments = tuningData.adjustments || [];
            const recentAdjustments = adjustments.slice(-5).reverse(); // √öltimos 5 ajustes
            const currentParams = tuningData.current_parameters || {};
            
            let html = '';
            
            if (recentAdjustments.length > 0) {
                html += '<div style="margin-bottom: 1.5rem;">';
                html += '<div style="font-size: 0.85rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.75rem;">Ajustes Recientes</div>';
                recentAdjustments.forEach(adj => {
                    const actionColor = adj.action === 'increase' ? 'var(--success)' : adj.action === 'decrease' ? 'var(--warning)' : 'var(--info)';
                    const actionIcon = adj.action === 'increase' ? '‚Üë' : adj.action === 'decrease' ? '‚Üì' : '‚Üí';
                html += `
                        <div style="padding: 0.75rem; background: var(--bg-tertiary); border-radius: 8px; border-left: 3px solid ${actionColor}; margin-bottom: 0.5rem;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.25rem;">
                                <div style="font-weight: 600; color: var(--text-primary); font-size: 0.9rem;">${adj.parameter || 'Par√°metro'}</div>
                                <span style="color: ${actionColor}; font-weight: 700; font-size: 1rem;">${actionIcon}</span>
                            </div>
                            <div style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 0.25rem;">
                                ${adj.old_value} ‚Üí ${adj.new_value}
                            </div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">${(adj.reason || '').substring(0, 50)}${(adj.reason || '').length > 50 ? '...' : ''}</div>
                    </div>
                `;
            });
            html += '</div>';
            }
            
            if (Object.keys(currentParams).length > 0) {
                html += '<div>';
                html += '<div style="font-size: 0.85rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.75rem;">Par√°metros Actuales</div>';
                html += '<div style="display: grid; gap: 0.5rem;">';
                for (const [key, value] of Object.entries(currentParams)) {
                    html += `
                        <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: var(--bg-tertiary); border-radius: 6px;">
                            <span style="font-size: 0.8rem; color: var(--text-secondary);">${key.replace(/_/g, ' ')}</span>
                            <span style="font-family: \'JetBrains Mono\', monospace; color: var(--primary); font-weight: 600; font-size: 0.85rem;">${value}</span>
                        </div>
                    `;
                }
                html += '</div></div>';
            }
            
            if (html === '') {
                html = '<div style="color: var(--text-secondary); text-align: center; padding: 2rem;">No se han realizado ajustes a√∫n</div>';
            }
            
            container.innerHTML = html;
        }
        
        // Update Security Analysis Display
        function updateSecurityAnalysis(securityData) {
            const container = document.getElementById('security-analysis-content');
            if (!container) return;
            
            if (!securityData || Object.keys(securityData).length === 0) {
                container.innerHTML = '<div style="color: var(--text-secondary); text-align: center; padding: 2rem;">Esperando an√°lisis de seguridad...</div>';
                return;
            }
            
            const vulnerabilities = securityData.vulnerabilities || [];
            const recentVulns = vulnerabilities.slice(-5).reverse(); // √öltimas 5
            const securityIssues = securityData.security_issues || [];
            const recentIssues = securityIssues.slice(-3).reverse(); // √öltimas 3
            
            let html = '';
            
            if (recentVulns.length > 0) {
                html += '<div style="margin-bottom: 1.5rem;">';
                html += '<div style="font-size: 0.85rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.75rem;">Vulnerabilidades Detectadas</div>';
                recentVulns.forEach(vuln => {
                    const severityColor = vuln.severity === 'high' ? 'var(--danger)' : vuln.severity === 'medium' ? 'var(--warning)' : 'var(--info)';
                    html += `
                        <div style="padding: 0.75rem; background: var(--bg-tertiary); border-radius: 8px; border-left: 3px solid ${severityColor}; margin-bottom: 0.5rem;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.25rem;">
                                <div style="font-weight: 600; color: var(--text-primary); font-size: 0.9rem;">${vuln.type || 'Vulnerabilidad'}</div>
                                <span style="background: ${severityColor}; color: #000; padding: 0.2rem 0.4rem; border-radius: 4px; font-size: 0.7rem; font-weight: 600;">${vuln.severity || 'info'}</span>
                            </div>
                            <div style="font-size: 0.8rem; color: var(--text-secondary);">${(vuln.description || '').substring(0, 60)}${(vuln.description || '').length > 60 ? '...' : ''}</div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            if (recentIssues.length > 0) {
                html += '<div>';
                html += '<div style="font-size: 0.85rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.75rem;">Problemas de Seguridad</div>';
                recentIssues.forEach(issue => {
                    const severityColor = issue.severity === 'high' ? 'var(--danger)' : issue.severity === 'medium' ? 'var(--warning)' : 'var(--info)';
                    html += `
                        <div style="padding: 0.75rem; background: var(--bg-tertiary); border-radius: 8px; border-left: 3px solid ${severityColor}; margin-bottom: 0.5rem;">
                            <div style="font-weight: 600; color: var(--text-primary); font-size: 0.9rem; margin-bottom: 0.25rem;">${issue.type || 'Problema'}</div>
                            <div style="font-size: 0.8rem; color: var(--text-secondary);">${(issue.description || '').substring(0, 50)}${(issue.description || '').length > 50 ? '...' : ''}</div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            if (html === '') {
                html = '<div style="color: var(--text-secondary); text-align: center; padding: 2rem;">No se han detectado problemas de seguridad</div>';
            }
            
            container.innerHTML = html;
        }
        
        // Update Charts
        function updateCharts() {
            const now = new Date();
            const timeLabel = now.toLocaleTimeString();
            
            // Requests Chart
            if (charts.requests) {
                const rps = stats.rps?.current || 0;
                charts.requests.data.labels.push(timeLabel);
                charts.requests.data.datasets[0].data.push(rps);
                
                // Keep last 30 data points
                if (charts.requests.data.labels.length > 30) {
                    charts.requests.data.labels.shift();
                    charts.requests.data.datasets[0].data.shift();
                }
                
                charts.requests.update('none');
            }
            
            // Latency Chart
            if (charts.latency && stats.latency_stats) {
                const avgLatency = stats.latency_stats.avg || 0;
                charts.latency.data.labels.push(timeLabel);
                charts.latency.data.datasets[0].data.push(avgLatency);
                
                if (charts.latency.data.labels.length > 30) {
                    charts.latency.data.labels.shift();
                    charts.latency.data.datasets[0].data.shift();
                }
                
                charts.latency.update('none');
            }
            
            // HTTP Codes Chart
            if (charts.httpCodes && stats.http_codes) {
                const codes = stats.http_codes;
                const labels = Object.keys(codes);
                const values = Object.values(codes);
                
                charts.httpCodes.data.labels = labels.map(c => `HTTP ${c}`);
                charts.httpCodes.data.datasets[0].data = values;
                charts.httpCodes.update();
            }
        }
        
        // Update HTTP Codes Distribution - mejorado con validaci√≥n y formato profesional
        function updateHttpCodesDistribution(codes) {
            const container = document.getElementById('http-codes-distribution');
            if (!container) return;
            
            // Validar y limpiar c√≥digos (asegurar que sean n√∫meros)
            const cleanCodes = {};
            for (const [code, count] of Object.entries(codes)) {
                const codeNum = parseInt(code);
                if (!isNaN(codeNum) && codeNum > 0 && count > 0) {
                    cleanCodes[codeNum] = parseInt(count);
                }
            }
            
            const total = Object.values(cleanCodes).reduce((a, b) => a + b, 0);
            if (total === 0) {
                container.innerHTML = '<div style="color: var(--text-secondary); text-align: center; padding: 2rem;">Esperando datos de c√≥digos HTTP...</div>';
                return;
            }
            
            let html = '<div style="display: grid; gap: 1rem;">';
            const sorted = Object.entries(cleanCodes).sort((a, b) => b[1] - a[1]);
            
            sorted.forEach(([code, count]) => {
                const codeNum = parseInt(code);
                const percentage = ((count / total) * 100).toFixed(1);
                
                // Colores profesionales seg√∫n categor√≠a
                let color, category;
                if (codeNum >= 500) {
                    color = '#ff3366';
                    category = 'Error del Servidor';
                } else if (codeNum >= 400) {
                    color = '#ffb800';
                    category = 'Error del Cliente';
                } else if (codeNum >= 300) {
                    color = '#00d9ff';
                    category = 'Redirecci√≥n';
                } else if (codeNum >= 200) {
                    color = '#00ff88';
                    category = '√âxito';
                } else {
                    color = '#888';
                    category = 'Informaci√≥n';
                }
                
                html += `
                    <div style="padding: 1rem; background: var(--bg-tertiary); border-radius: 8px; border-left: 4px solid ${color};">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <div>
                                <span style="font-family: 'JetBrains Mono', monospace; color: ${color}; font-weight: 700; font-size: 1.1rem;">HTTP ${codeNum}</span>
                                <span style="margin-left: 0.5rem; font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase;">${category}</span>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-weight: 700; color: var(--text-primary); font-size: 1rem;">${formatNumber(count)}</div>
                                <div style="font-size: 0.75rem; color: var(--text-secondary);">${percentage}%</div>
                            </div>
                        </div>
                        <div style="background: var(--bg-primary); border-radius: 4px; height: 8px; overflow: hidden;">
                            <div style="width: ${percentage}%; background: ${color}; height: 100%; transition: width 0.3s ease;"></div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        // Update Attack Status
        function updateAttackStatus(isActive) {
            const badge = document.getElementById('attack-status-badge');
            if (badge) {
                badge.className = 'status-badge ' + (isActive ? 'active' : 'inactive');
                badge.querySelector('span:last-child').textContent = isActive ? 'Activo' : 'Inactivo';
            }
        }
        
        // Load Reports
        async function loadReports() {
            try {
                const response = await fetch('/api/reports');
                const data = await response.json();
                
                const container = document.getElementById('reports-list');
                if (data.reports && data.reports.length > 0) {
                    let html = '<table class="table" style="width: 100%;"><tr><th>Nombre</th><th>Tama√±o</th><th>Fecha</th><th>Acciones</th></tr>';
                    data.reports.forEach(report => {
                        const date = new Date(report.modified);
                        html += `
                            <tr>
                                <td style="font-weight: 600;">${report.name}</td>
                                <td>${formatBytes(report.size)}</td>
                                <td>${date.toLocaleString()}</td>
                                <td>
                                    <a href="/api/reports/${report.path}" target="_blank" class="btn btn-sm btn-primary" style="margin-right: 8px; display: inline-block; padding: 0.4rem 0.8rem; background: var(--primary); color: var(--bg-primary); border-radius: 6px; text-decoration: none; font-weight: 600;">
                                        <i class="fas fa-eye"></i> Ver HTML
                                    </a>
                                    <a href="/api/reports/${report.path}/pdf" target="_blank" class="btn btn-sm btn-secondary" style="display: inline-block; padding: 0.4rem 0.8rem; background: var(--secondary); color: var(--bg-primary); border-radius: 6px; text-decoration: none; font-weight: 600;">
                                        <i class="fas fa-file-pdf"></i> PDF
                                    </a>
                                </td>
                            </tr>
                        `;
                    });
                    html += '</table>';
                    container.innerHTML = html;
                } else {
                    container.innerHTML = '<div style="color: var(--text-secondary); text-align: center; padding: 3rem;">No hay reportes disponibles</div>';
                }
            } catch (error) {
                console.error('Error loading reports:', error);
            }
        }
        
        // Load History with report viewing
        async function loadHistory() {
            try {
                const response = await fetch('/api/history?limit=50');
                const data = await response.json();
                
                const container = document.getElementById('history-list');
                if (data.status === 'success' && data.history && data.history.length > 0) {
                    let html = '<div style="display: grid; gap: 1rem;">';
                    data.history.forEach(entry => {
                        const date = new Date(entry.timestamp);
                        html += `
                            <div class="card" style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 1.5rem;">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                                    <div>
                                        <h3 style="margin: 0 0 0.5rem 0; color: var(--primary); font-size: 1.1rem;">
                                            ${entry.target || entry.domain || 'N/A'}
                                        </h3>
                                        <div style="color: var(--text-secondary); font-size: 0.9rem;">
                                            ${date.toLocaleString()} ‚Ä¢ ${entry.duration || entry.elapsed_time || 0}s ‚Ä¢ ${entry.power_level || 'N/A'}
                                    </div>
                                </div>
                                    <div style="text-align: right;">
                                        <div style="color: var(--success); font-size: 1.5rem; font-weight: 700;">
                                            ${entry.success_rate || 0}%
                                        </div>
                                        <div style="color: var(--text-secondary); font-size: 0.8rem;">Tasa de √©xito</div>
                                    </div>
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                                    <div>
                                        <div style="color: var(--text-secondary); font-size: 0.85rem;">Requests</div>
                                        <div style="color: var(--primary); font-size: 1.2rem; font-weight: 600;">${formatNumber(entry.requests_sent || 0)}</div>
                                    </div>
                                    <div>
                                        <div style="color: var(--text-secondary); font-size: 0.85rem;">RPS Promedio</div>
                                        <div style="color: var(--info); font-size: 1.2rem; font-weight: 600;">${formatNumber(entry.avg_rps || 0)}</div>
                                    </div>
                                    <div>
                                        <div style="color: var(--text-secondary); font-size: 0.85rem;">Latencia P95</div>
                                        <div style="color: var(--warning); font-size: 1.2rem; font-weight: 600;">${entry.p95_latency_ms || 0}ms</div>
                                    </div>
                                    <div>
                                        <div style="color: var(--text-secondary); font-size: 0.85rem;">Errores</div>
                                        <div style="color: ${entry.errors > 0 ? 'var(--danger)' : 'var(--success)'}; font-size: 1.2rem; font-weight: 600;">${formatNumber(entry.errors || 0)}</div>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                    ${entry.has_full_report ? `
                                        <a href="/api/history/${entry.id}" target="_blank" class="btn btn-sm btn-primary" style="display: inline-block; padding: 0.4rem 0.8rem; background: var(--primary); color: var(--bg-primary); border-radius: 6px; text-decoration: none; font-weight: 600;">
                                            <i class="fas fa-file-alt"></i> Ver Reporte Completo
                                        </a>
                                        <a href="/api/history/${entry.id}/pdf" target="_blank" class="btn btn-sm btn-secondary" style="display: inline-block; padding: 0.4rem 0.8rem; background: var(--secondary); color: var(--bg-primary); border-radius: 6px; text-decoration: none; font-weight: 600;">
                                            <i class="fas fa-file-pdf"></i> Exportar PDF
                                        </a>
                                    ` : `
                                        <span style="color: var(--text-muted); font-size: 0.85rem;">Reporte completo no disponible</span>
                                    `}
                                </div>
                            </div>
                        `;
                    });
                    html += '</div>';
                    container.innerHTML = html;
                } else {
                    container.innerHTML = '<div style="color: var(--text-secondary); text-align: center; padding: 3rem;">No hay historial disponible</div>';
                }
            } catch (error) {
                console.error('Error loading history:', error);
            }
        }
        
        // Run Autodiagnostic
        async function runAutodiagnostic() {
            const container = document.getElementById('tools-content');
            container.innerHTML = `
                <div style="text-align: center; padding: 2rem;">
                    <div class="spinner" style="margin: 0 auto;"></div>
                    <div style="margin-top: 1rem; color: var(--text-secondary);">Ejecutando autodiagn√≥stico completo...</div>
                </div>
            `;
            
            try {
                showAlert('Ejecutando autodiagn√≥stico completo...', 'info');
                
                const response = await fetch('/api/autodiagnostic', {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const result = await response.json();
                
                if (response.ok && result.status === 'success') {
                    displayAutodiagnostic(result.report);
                    showAlert('Autodiagn√≥stico completado', 'success');
                } else {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 3rem; color: var(--danger);">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                            <div style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem;">Error en Autodiagn√≥stico</div>
                            <div style="color: var(--text-secondary);">${result.message || 'Error desconocido'}</div>
                            </div>
                        `;
                    showAlert(result.message || 'Error en autodiagn√≥stico', 'error');
                }
            } catch (error) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--danger);">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                        <div style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem;">Error de Conexi√≥n</div>
                        <div style="color: var(--text-secondary);">${error.message}</div>
                    </div>
                `;
                showAlert('Error: ' + error.message, 'error');
            }
        }
        
        // Display Autodiagnostic Results
        function displayAutodiagnostic(report) {
            const container = document.getElementById('tools-content');
            const summary = report.summary;
            const successRate = summary.success_rate.toFixed(1);
            
            let html = `
                <div style="margin-bottom: 2rem;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                        <div class="card" style="background: var(--bg-card); border: 1px solid var(--border); padding: 1.5rem; border-radius: 12px; text-align: center;">
                            <div style="font-size: 2.5rem; font-weight: 800; color: var(--primary); margin-bottom: 0.5rem;">${summary.total_checks}</div>
                            <div style="color: var(--text-secondary); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;">Total Verificaciones</div>
                        </div>
                        <div class="card" style="background: var(--bg-card); border: 1px solid var(--success); padding: 1.5rem; border-radius: 12px; text-align: center;">
                            <div style="font-size: 2.5rem; font-weight: 800; color: var(--success); margin-bottom: 0.5rem;">${summary.passed}</div>
                            <div style="color: var(--text-secondary); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;">Exitosas</div>
                        </div>
                        <div class="card" style="background: var(--bg-card); border: 1px solid ${summary.failed > 0 ? 'var(--danger)' : 'var(--border)'}; padding: 1.5rem; border-radius: 12px; text-align: center;">
                            <div style="font-size: 2.5rem; font-weight: 800; color: ${summary.failed > 0 ? 'var(--danger)' : 'var(--text-secondary)'}; margin-bottom: 0.5rem;">${summary.failed}</div>
                            <div style="color: var(--text-secondary); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;">Fallidas</div>
                        </div>
                        <div class="card" style="background: var(--bg-card); border: 1px solid ${summary.warnings > 0 ? 'var(--warning)' : 'var(--border)'}; padding: 1.5rem; border-radius: 12px; text-align: center;">
                            <div style="font-size: 2.5rem; font-weight: 800; color: ${summary.warnings > 0 ? 'var(--warning)' : 'var(--text-secondary)'}; margin-bottom: 0.5rem;">${summary.warnings}</div>
                            <div style="color: var(--text-secondary); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;">Advertencias</div>
                        </div>
                        <div class="card" style="background: var(--bg-card); border: 1px solid var(--primary); padding: 1.5rem; border-radius: 12px; text-align: center;">
                            <div style="font-size: 2.5rem; font-weight: 800; color: var(--primary); margin-bottom: 0.5rem;">${successRate}%</div>
                            <div style="color: var(--text-secondary); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;">Tasa de √âxito</div>
                        </div>
                    </div>
                </div>
            `;
            
            // Mostrar errores cr√≠ticos
            if (report.errors && report.errors.length > 0) {
                html += `
                    <div class="card" style="background: var(--bg-card); border: 1px solid var(--danger); padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem;">
                        <div class="card-header">
                            <div class="card-title" style="color: var(--danger);">
                                <i class="fas fa-exclamation-triangle"></i>
                                Errores Cr√≠ticos (${report.errors.length})
                            </div>
                        </div>
                        <div class="card-body">
                            <div style="display: grid; gap: 1rem;">
                `;
                
                report.errors.slice(0, 20).forEach(error => {
                    html += `
                        <div style="padding: 1rem; background: var(--bg-tertiary); border-radius: 8px; border-left: 3px solid var(--danger);">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                                <div style="font-weight: 600; color: var(--danger);">
                                    [${error.category}] ${error.item}
                                </div>
                                <span style="background: var(--danger); color: #000; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.7rem; font-weight: 600;">
                                    ${error.severity.toUpperCase()}
                                </span>
                            </div>
                            <div style="color: var(--text-primary); margin-bottom: 0.5rem;">${error.message}</div>
                            <div style="padding: 0.75rem; background: var(--bg-secondary); border-radius: 6px; margin-top: 0.5rem;">
                                <div style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.25rem;">Soluci√≥n:</div>
                                <div style="color: var(--primary); font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">${error.solution}</div>
                            </div>
                        </div>
                    `;
                });
                
                if (report.errors.length > 20) {
                    html += `
                        <div style="text-align: center; padding: 1rem; color: var(--text-secondary);">
                            ... y ${report.errors.length - 20} error(es) m√°s
                        </div>
                    `;
                }
                
                html += `
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Mostrar advertencias
            if (report.warnings && report.warnings.length > 0) {
                html += `
                    <div class="card" style="background: var(--bg-card); border: 1px solid var(--warning); padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem;">
                        <div class="card-header">
                            <div class="card-title" style="color: var(--warning);">
                                <i class="fas fa-exclamation-circle"></i>
                                Advertencias (${report.warnings.length})
                            </div>
                        </div>
                        <div class="card-body">
                            <div style="display: grid; gap: 1rem;">
                `;
                
                report.warnings.slice(0, 10).forEach(warning => {
                    html += `
                        <div style="padding: 1rem; background: var(--bg-tertiary); border-radius: 8px; border-left: 3px solid var(--warning);">
                            <div style="font-weight: 600; color: var(--warning); margin-bottom: 0.5rem;">
                                [${warning.category}] ${warning.item}
                            </div>
                            <div style="color: var(--text-primary); margin-bottom: 0.5rem;">${warning.message}</div>
                            <div style="color: var(--text-secondary); font-size: 0.85rem;">${warning.solution}</div>
                        </div>
                    `;
                });
                
                html += `
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Mostrar sugerencias
            if (report.suggestions && report.suggestions.length > 0) {
                html += `
                    <div class="card" style="background: var(--bg-card); border: 1px solid var(--primary); padding: 1.5rem; border-radius: 12px;">
                        <div class="card-header">
                            <div class="card-title" style="color: var(--primary);">
                                <i class="fas fa-lightbulb"></i>
                                Sugerencias Autom√°ticas
                            </div>
                        </div>
                        <div class="card-body">
                            <div style="display: grid; gap: 1rem;">
                `;
                
                report.suggestions.forEach(suggestion => {
                    html += `
                        <div style="padding: 1rem; background: var(--bg-tertiary); border-radius: 8px; border-left: 3px solid var(--primary);">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                                <div style="font-weight: 600; color: var(--primary);">${suggestion.message}</div>
                                <span style="background: var(--primary); color: #000; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.7rem; font-weight: 600;">
                                    ${suggestion.priority.toUpperCase()}
                                </span>
                            </div>
                            <div style="color: var(--text-secondary); font-size: 0.85rem;">${suggestion.action}</div>
                        </div>
                    `;
                });
                
                html += `
                            </div>
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
        
        // Load Tools
        async function loadTools() {
            try {
                const response = await fetch('/api/tools');
                const data = await response.json();
                
                const container = document.getElementById('tools-grid');
                if (data.tools) {
                    let html = '';
                    for (const [tool, available] of Object.entries(data.tools)) {
                        html += `
                            <div class="tool-item ${available ? 'available' : 'unavailable'}">
                                <span class="tool-name">${tool}</span>
                                <span class="tool-status">${available ? '‚úì' : '‚úó'}</span>
                            </div>
                        `;
                    }
                    container.innerHTML = html;
                }
            } catch (error) {
                console.error('Error loading tools:', error);
            }
        }
        
        // Start Updates
        function startUpdates() {
            updateStats();
            updateInterval = setInterval(updateStats, 2000);
            
            // Load initial data
            loadReports();
            loadTools();
            updateSystemInfo();
            setInterval(updateSystemInfo, 5000);
            
            // Start log streaming
            startLogStreaming();
        }
        
        // Log Streaming
        let logPosition = 0;
        let logStreamInterval = null;
        
        function startLogStreaming() {
            updateLogs();
            logStreamInterval = setInterval(updateLogs, 1000); // Actualizar cada segundo
        }
        
        async function updateLogs() {
            try {
                const response = await fetch(`/api/logs?lines=200&last_position=${logPosition}`);
                const data = await response.json();
                
                if (data.status === 'success' && data.logs) {
                    const container = document.getElementById('logs-container');
                    if (container && data.logs.length > 0) {
                        // Agregar nuevos logs
                        data.logs.forEach(line => {
                            if (line.trim()) {
                                const logLine = document.createElement('div');
                                logLine.style.marginBottom = '4px';
                                logLine.style.padding = '4px 8px';
                                logLine.style.borderRadius = '4px';
                                
                                // Colorear seg√∫n nivel
                                if (line.includes('[ERROR]') || line.includes('‚ùå')) {
                                    logLine.style.color = '#ff3366';
                                    logLine.style.background = 'rgba(255, 51, 102, 0.1)';
                                } else if (line.includes('[WARN]') || line.includes('‚ö†Ô∏è')) {
                                    logLine.style.color = '#ffb800';
                                    logLine.style.background = 'rgba(255, 184, 0, 0.1)';
                                } else if (line.includes('[INFO]') || line.includes('‚úÖ') || line.includes('üìä')) {
                                    logLine.style.color = '#00ff88';
                                    logLine.style.background = 'rgba(0, 255, 136, 0.1)';
                                } else if (line.includes('[DEBUG]')) {
                                    logLine.style.color = '#00d9ff';
                                    logLine.style.background = 'rgba(0, 217, 255, 0.1)';
                                } else {
                                    logLine.style.color = '#b4b4c8';
                                }
                                
                                logLine.textContent = line.trim();
                                container.appendChild(logLine);
                                
                                // Limitar a 500 l√≠neas
                                while (container.children.length > 500) {
                                    container.removeChild(container.firstChild);
                                }
                            }
                        });
                        
                        // Auto-scroll al final
                        container.scrollTop = container.scrollHeight;
                    }
                    
                    // Actualizar posici√≥n para streaming
                    if (data.position !== undefined) {
                        logPosition = data.position;
                    }
                }
            } catch (error) {
                console.error('Error updating logs:', error);
            }
        }
        
        // Update System Info
        async function updateSystemInfo() {
            try {
                const response = await fetch('/api/system-info');
                const data = await response.json();
                
                if (data.status === 'success' && data.system) {
                    const sys = data.system;
                    
                    document.getElementById('cpu-usage').textContent = Math.round(sys.cpu_percent || 0) + '%';
                    document.getElementById('cpu-progress').style.width = (sys.cpu_percent || 0) + '%';
                    
                    document.getElementById('memory-usage').textContent = Math.round(sys.memory_percent || 0) + '%';
                    document.getElementById('memory-progress').style.width = (sys.memory_percent || 0) + '%';
                    
                    const infoContainer = document.getElementById('system-info');
                    if (infoContainer) {
                        infoContainer.innerHTML = `
                            <table class="table">
                                <tr><th>Propiedad</th><th>Valor</th></tr>
                                <tr><td>CPU Cores</td><td>${sys.cpu_count || 'N/A'}</td></tr>
                                <tr><td>Memoria Total</td><td>${sys.memory_total_gb || 0} GB</td></tr>
                                <tr><td>Memoria Usada</td><td>${sys.memory_used_gb || 0} GB</td></tr>
                                <tr><td>Disco Total</td><td>${sys.disk_total_gb || 0} GB</td></tr>
                                <tr><td>Disco Usado</td><td>${sys.disk_used_gb || 0} GB</td></tr>
                            </table>
                        `;
                    }
                }
            } catch (error) {
                console.error('Error updating system info:', error);
            }
        }
        
        // Utility Functions
        function formatNumber(num) {
            return new Intl.NumberFormat('es-ES').format(num);
        }
        
        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }
        
        function showAlert(message, type) {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type === 'success' ? 'success' : type === 'error' ? 'error' : 'warning'}`;
            alert.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i> ${message}`;
            alert.style.position = 'fixed';
            alert.style.top = '100px';
            alert.style.right = '20px';
            alert.style.zIndex = '10000';
            alert.style.minWidth = '350px';
            alert.style.boxShadow = 'var(--shadow-xl)';
            
            document.body.appendChild(alert);
            
            setTimeout(() => {
                alert.style.opacity = '0';
                alert.style.transform = 'translateX(100px)';
                setTimeout(() => alert.remove(), 300);
            }, 5000);
        }
        
        // Toggle Section Function
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            const icon = document.getElementById(sectionId + '-icon');
            
            if (section) {
                const isVisible = section.style.display !== 'none';
                section.style.display = isVisible ? 'none' : 'block';
                
                if (icon) {
                    icon.style.transform = isVisible ? 'rotate(0deg)' : 'rotate(180deg)';
                }
            }
        }
        
        // Run Autodiagnostic
        async function runAutodiagnostic() {
            const container = document.getElementById('autodiagnostic-results');
            const content = document.getElementById('autodiagnostic-content');
            
            if (!container || !content) {
                showAlert('Error: Contenedor de autodiagn√≥stico no encontrado', 'error');
                return;
            }
            
            // Mostrar estado de progreso
            content.innerHTML = `
                <div style="text-align: center; padding: 3rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem; color: var(--primary);">
                        <i class="fas fa-spinner fa-spin"></i>
                    </div>
                    <div style="font-size: 1.2rem; color: var(--primary); margin-bottom: 0.5rem; font-weight: 600;">
                        Ejecutando Autodiagn√≥stico...
                    </div>
                    <div style="color: var(--text-secondary); font-size: 0.9rem;">
                        Esto puede tomar unos momentos...
                    </div>
                </div>
            `;
            container.style.display = 'block';
            
            try {
                showAlert('Ejecutando autodiagn√≥stico completo...', 'info');
                
                const response = await fetch('/api/autodiagnostic', {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const result = await response.json();
                
                if (response.ok && result.status === 'success') {
                    displayAutodiagnostic(result.report);
                    showAlert('Autodiagn√≥stico completado exitosamente', 'success');
                } else {
                    content.innerHTML = `
                        <div style="text-align: center; padding: 3rem; color: var(--danger);">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                            <div style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem;">Error en Autodiagn√≥stico</div>
                            <div style="color: var(--text-secondary);">${result.message || 'Error desconocido'}</div>
                        </div>
                    `;
                    showAlert('Error: ' + (result.message || 'Error desconocido'), 'error');
                }
            } catch (error) {
                content.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--danger);">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                        <div style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem;">Error de Conexi√≥n</div>
                        <div style="color: var(--text-secondary);">${error.message}</div>
                    </div>
                `;
                showAlert('Error: ' + error.message, 'error');
            }
        }
        
        // Display Autodiagnostic Results
        function displayAutodiagnostic(report) {
            const content = document.getElementById('autodiagnostic-content');
            if (!content || !report) return;
            
            const summary = report.summary || {};
            const errors = report.errors || [];
            const warnings = report.warnings || [];
            const suggestions = report.suggestions || [];
            const checks = report.checks || {};
            
            let html = `
                <div style="margin-bottom: 1.5rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: var(--bg-tertiary); border-radius: 12px; border: 1px solid var(--border); margin-bottom: 1rem;">
                        <div>
                            <div style="font-size: 1.1rem; font-weight: 600; color: var(--primary); margin-bottom: 0.25rem;">
                                <i class="fas fa-stethoscope"></i> Resumen del Autodiagn√≥stico
                            </div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary);">
                                ${new Date(report.timestamp || new Date()).toLocaleString('es-ES')}
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary);">
                                ${summary.success_rate?.toFixed(1) || 0}%
                            </div>
                            <div style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px;">
                                Tasa de √âxito
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                        <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: 12px; border: 1px solid var(--border); text-align: center;">
                            <div style="font-size: 2rem; font-weight: 700; color: var(--success); margin-bottom: 0.5rem;">
                                ${summary.passed || 0}
                            </div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px;">
                                Exitosas
                            </div>
                        </div>
                        <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: 12px; border: 1px solid var(--border); text-align: center;">
                            <div style="font-size: 2rem; font-weight: 700; color: var(--danger); margin-bottom: 0.5rem;">
                                ${summary.failed || 0}
                            </div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px;">
                                Fallidas
                            </div>
                        </div>
                        <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: 12px; border: 1px solid var(--border); text-align: center;">
                            <div style="font-size: 2rem; font-weight: 700; color: var(--warning); margin-bottom: 0.5rem;">
                                ${summary.warnings || 0}
                            </div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px;">
                                Advertencias
                            </div>
                        </div>
                        <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: 12px; border: 1px solid var(--border); text-align: center;">
                            <div style="font-size: 2rem; font-weight: 700; color: var(--info); margin-bottom: 0.5rem;">
                                ${summary.total_checks || 0}
                            </div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px;">
                                Total
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Errores
            if (errors.length > 0) {
                html += `
                    <div style="margin-bottom: 1.5rem;">
                        <div style="font-size: 1rem; font-weight: 600; color: var(--danger); margin-bottom: 0.75rem;">
                            <i class="fas fa-exclamation-circle"></i> Errores Cr√≠ticos (${errors.length})
                        </div>
                        <div style="background: var(--bg-tertiary); border-radius: 12px; border: 1px solid var(--border); padding: 1rem; max-height: 300px; overflow-y: auto;">
                `;
                errors.forEach(error => {
                    html += `
                        <div style="padding: 0.75rem; margin-bottom: 0.5rem; background: rgba(255, 51, 102, 0.1); border-left: 3px solid var(--danger); border-radius: 8px;">
                            <div style="font-weight: 600; color: var(--danger); margin-bottom: 0.25rem;">
                                ${error.item || 'N/A'}
                            </div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
                                ${error.message || ''}
                            </div>
                            <div style="font-size: 0.75rem; color: var(--primary);">
                                <i class="fas fa-lightbulb"></i> ${error.solution || 'Sin soluci√≥n disponible'}
                            </div>
                        </div>
                    `;
                });
                html += `</div></div>`;
            }
            
            // Advertencias
            if (warnings.length > 0) {
                html += `
                    <div style="margin-bottom: 1.5rem;">
                        <div style="font-size: 1rem; font-weight: 600; color: var(--warning); margin-bottom: 0.75rem;">
                            <i class="fas fa-exclamation-triangle"></i> Advertencias (${warnings.length})
                        </div>
                        <div style="background: var(--bg-tertiary); border-radius: 12px; border: 1px solid var(--border); padding: 1rem; max-height: 300px; overflow-y: auto;">
                `;
                warnings.forEach(warning => {
                    html += `
                        <div style="padding: 0.75rem; margin-bottom: 0.5rem; background: rgba(255, 184, 0, 0.1); border-left: 3px solid var(--warning); border-radius: 8px;">
                            <div style="font-weight: 600; color: var(--warning); margin-bottom: 0.25rem;">
                                ${warning.item || 'N/A'}
                            </div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem;">
                                ${warning.message || ''}
                            </div>
                            <div style="font-size: 0.75rem; color: var(--primary);">
                                <i class="fas fa-lightbulb"></i> ${warning.solution || 'Sin soluci√≥n disponible'}
                            </div>
                        </div>
                    `;
                });
                html += `</div></div>`;
            }
            
            // Sugerencias
            if (suggestions.length > 0) {
                html += `
                    <div style="margin-bottom: 1.5rem;">
                        <div style="font-size: 1rem; font-weight: 600; color: var(--primary); margin-bottom: 0.75rem;">
                            <i class="fas fa-lightbulb"></i> Sugerencias (${suggestions.length})
                        </div>
                        <div style="background: var(--bg-tertiary); border-radius: 12px; border: 1px solid var(--border); padding: 1rem;">
                `;
                suggestions.forEach(suggestion => {
                    const priorityColor = suggestion.priority === 'high' || suggestion.priority === 'critical' ? 'var(--danger)' : 'var(--warning)';
                    html += `
                        <div style="padding: 0.75rem; margin-bottom: 0.5rem; background: rgba(0, 255, 136, 0.1); border-left: 3px solid var(--primary); border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                                <div style="font-weight: 600; color: var(--primary);">
                                    ${suggestion.message || ''}
                                </div>
                                <span style="background: ${priorityColor}; color: #000; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.7rem; font-weight: 600; text-transform: uppercase;">
                                    ${suggestion.priority || 'medium'}
                                </span>
                            </div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary);">
                                <i class="fas fa-arrow-right"></i> ${suggestion.action || 'Sin acci√≥n disponible'}
                            </div>
                        </div>
                    `;
                });
                html += `</div></div>`;
            }
            
            content.innerHTML = html;
        }
        
        // Apply Stress Recommendations
        async function applyStressRecommendations() {
            try {
                const response = await fetch('/api/fingerprint', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ target: document.getElementById('config-target').value })
                });
                
                const result = await response.json();
                
                if (response.ok && result.stress_recommendations) {
                    const recs = result.stress_recommendations;
                    
                    // Aplicar recomendaciones a los campos
                    if (recs.recommended_power_level) {
                        document.getElementById('config-power').value = recs.recommended_power_level;
                    }
                    if (recs.recommended_duration) {
                        document.getElementById('config-duration').value = recs.recommended_duration;
                    }
                    if (recs.recommended_connections) {
                        document.getElementById('config-connections').value = recs.recommended_connections;
                    }
                    if (recs.recommended_threads) {
                        document.getElementById('config-threads').value = recs.recommended_threads;
                    }
                    if (recs.recommended_waf_bypass !== undefined) {
                        document.getElementById('config-waf-bypass').checked = recs.recommended_waf_bypass;
                    }
                    if (recs.recommended_stealth !== undefined) {
                        document.getElementById('config-stealth').checked = recs.recommended_stealth;
                    }
                    
                    showAlert('Recomendaciones de stress aplicadas exitosamente', 'success');
                } else {
                    showAlert('No se pudieron obtener recomendaciones', 'warning');
                }
            } catch (error) {
                showAlert('Error aplicando recomendaciones: ' + error.message, 'error');
            }
        }
        
        // Apply Tool Recommendations
        async function applyToolRecommendations() {
            try {
                const response = await fetch('/api/fingerprint', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ target: document.getElementById('config-target').value })
                });
                
                const result = await response.json();
                
                if (response.ok && result.tool_recommendations) {
                    const toolRecs = result.tool_recommendations;
                    showAlert(`Se recomiendan ${toolRecs.tool_count || toolRecs.recommended_tools.length} herramienta(s): ${toolRecs.recommended_tools.join(', ')}`, 'info');
                    // Las herramientas se aplicar√°n autom√°ticamente al iniciar el ataque
                } else {
                    showAlert('No se pudieron obtener recomendaciones de herramientas', 'warning');
                }
            } catch (error) {
                showAlert('Error aplicando recomendaciones de herramientas: ' + error.message, 'error');
            }
        }
    </script>
</body>
</html>
